<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>å…¨æ¯æˆ˜ç•¥å®¡è®¡ç»ˆç«¯ | é€šç”¨ç‰ˆ v7.0</title>
    <!-- ä¾èµ–åº“ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'git-bg': '#0d1117',
                        'git-panel': '#161b22',
                        'git-border': '#30363d',
                        'git-blue': '#58a6ff',
                        'git-green': '#3fb950',
                        'git-red': '#f85149'
                    },
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                        sans: ['Inter', 'Microsoft YaHei', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Inter', 'Microsoft YaHei', sans-serif; }
        .glass { background: rgba(22, 27, 34, 0.95); backdrop-filter: blur(20px); border: 1px solid #30363d; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Markdown æ ·å¼ */
        .prose h1 { font-size: 1.8rem; font-weight: 900; color: #58a6ff; border-bottom: 2px solid #30363d; padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
        .prose h2 { font-size: 1.4rem; font-weight: 800; color: #3fb950; margin-top: 2rem; margin-bottom: 1rem; border-left: 4px solid #3fb950; padding-left: 1rem; }
        .prose p { line-height: 2; margin-bottom: 1.2rem; text-align: justify; color: #acbac7; }
        .prose strong { color: #fff; }
        .prose blockquote { border-left: 4px solid #58a6ff; padding: 1rem 1.5rem; font-style: italic; color: #8b949e; background: #161b22; border-radius: 0 0.5rem 0.5rem 0; }
        .prose ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1.5rem; color: #acbac7; }

        @media print {
            .no-print { display: none !important; }
            body { background: white !important; color: black !important; padding: 0 !important; }
            .glass { background: white !important; border: 1px solid #ddd !important; box-shadow: none !important; color: black !important; }
            .prose h1, .prose h2 { color: black !important; border-bottom: 2px solid black !important; }
            .prose p, .prose li { color: #111 !important; }
        }
        
        .radar-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 450px;
            margin: 0 auto;
        }
        .loader-dots::after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body class="p-2 md:p-8 min-h-screen">

    <!-- ç³»ç»Ÿé¡µçœ‰ -->
    <header class="max-w-7xl mx-auto mb-10 flex justify-between items-center border-b border-git-border pb-8 no-print">
        <div class="flex items-center gap-6">
            <div class="p-4 bg-git-panel border border-git-border rounded-2xl shadow-xl shadow-blue-500/5">
                <i class="fa-solid fa-users-gear text-3xl text-git-blue"></i>
            </div>
            <div>
                <div class="flex items-center gap-3">
                    <h1 class="text-3xl font-black text-white tracking-tighter uppercase italic">å…¨æ¯æˆ˜ç•¥å®¡è®¡ç»ˆç«¯</h1>
                    <span class="px-2 py-0.5 bg-git-blue/10 text-git-blue text-[9px] font-bold border border-git-blue/20 rounded uppercase tracking-widest">v7.0 Universal</span>
                </div>
                <p class="text-[10px] text-slate-500 font-mono tracking-[0.3em] mt-1 uppercase">å½“å‰åˆ†æå¸ˆï¼šæ³¢ (Bo) // é€šç”¨ç”Ÿå‘½æ•°å­—åè®®å·²åŠ è½½</p>
            </div>
        </div>
        <div class="flex gap-4">
            <button onclick="shareWhatsApp()" class="group flex items-center gap-2 px-6 py-3 bg-git-panel border border-git-border rounded-xl text-xs font-black uppercase tracking-widest hover:border-git-green transition-all shadow-lg">
                <i class="fa-brands fa-whatsapp text-git-green text-lg"></i> <span>åˆ†äº«å®¡è®¡æ‘˜è¦</span>
            </button>
            <button onclick="window.print()" class="flex items-center gap-2 px-6 py-3 bg-git-green text-white rounded-xl text-xs font-black uppercase tracking-widest shadow-xl shadow-git-green/20 hover:brightness-105 active:scale-95 transition-all">
                <i class="fa-solid fa-file-pdf"></i> <span>å¯¼å‡º PDF æŠ¥å‘Š</span>
            </button>
        </div>
    </header>

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- å·¦ä¾§é¢æ¿ï¼šå¯¹è±¡ä¾§å†™ -->
        <aside class="lg:col-span-4 space-y-6">
            <div class="glass p-8 rounded-[2.5rem] shadow-2xl relative overflow-hidden h-full">
                <div class="absolute -top-12 -right-12 opacity-5 pointer-events-none">
                    <i class="fa-solid fa-id-card text-[12rem]"></i>
                </div>
                
                <div class="flex items-center gap-5 mb-10 pb-8 border-b border-git-border">
                    <div id="gender-display" class="w-20 h-20 rounded-3xl bg-git-bg border border-git-border flex items-center justify-center text-4xl shadow-inner text-git-blue">
                        <i class="fa-solid fa-mars"></i>
                    </div>
                    <div class="flex-1">
                        <input type="text" id="userName" value="é˜¿ç›› (Castor)" oninput="updateProfileUI()" class="bg-transparent border-b border-git-border w-full text-2xl font-black text-white focus:border-git-blue outline-none py-1 mb-2">
                        <p id="system-id" class="text-[10px] text-slate-500 font-mono uppercase tracking-[0.2em]"></p>
                    </div>
                </div>

                <div class="space-y-6 mb-10">
                    <div class="flex justify-between items-center bg-git-bg p-4 rounded-2xl border border-git-border">
                        <span class="text-[10px] font-black text-slate-500 uppercase">ä¸»å‘½æ ¸å¿ƒ</span>
                        <span id="main-num-box" class="text-2xl font-black text-git-blue">--</span>
                    </div>
                    <div class="flex justify-between items-center bg-git-bg p-4 rounded-2xl border border-git-border">
                        <span class="text-[10px] font-black text-slate-500 uppercase">åé•‡åº•è•´</span>
                        <span id="root-num-box" class="text-2xl font-black text-git-green">--</span>
                    </div>
                </div>

                <div id="metrics-stack" class="space-y-8">
                    <!-- Metrics dynamic injection -->
                </div>

                <div class="mt-12 pt-8 border-t border-git-border">
                    <button onclick="resetInputs()" class="w-full py-4 bg-git-bg hover:bg-git-red/10 border border-git-border rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-git-red hover:border-git-red transition-all">
                        <i class="fa-solid fa-trash-can mr-2"></i> æ¸…ç©ºå½“å‰åˆ†æå¯¹è±¡
                    </button>
                </div>
            </div>
        </aside>

        <!-- ä¸»å·¥ä½œåŒº -->
        <main class="lg:col-span-8 space-y-8">
            <!-- å½•å…¥æ§åˆ¶å° -->
            <section class="glass p-8 rounded-[2rem] shadow-xl no-print">
                <div class="grid grid-cols-1 md:grid-cols-12 gap-8 items-center">
                    <div class="md:col-span-8 grid grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="text-[10px] text-slate-500 font-black uppercase tracking-widest ml-1">å‡ºç”Ÿå¹´ä»½</label>
                            <select id="birthYear" onchange="refreshEngine()" class="w-full bg-git-bg border border-git-border rounded-xl p-4 text-sm font-black text-white focus:border-git-blue outline-none cursor-pointer"></select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] text-slate-500 font-black uppercase tracking-widest ml-1">å‡ºç”Ÿæœˆä»½</label>
                            <select id="birthMonth" onchange="refreshEngine()" class="w-full bg-git-bg border border-git-border rounded-xl p-4 text-sm font-black text-white focus:border-git-blue outline-none cursor-pointer"></select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] text-slate-500 font-black uppercase tracking-widest ml-1">å‡ºç”Ÿæ—¥æœŸ</label>
                            <select id="birthDay" onchange="refreshEngine()" class="w-full bg-git-bg border border-git-border rounded-xl p-4 text-sm font-black text-white focus:border-git-blue outline-none cursor-pointer"></select>
                        </div>
                    </div>
                    <div class="md:col-span-4 flex flex-col gap-4">
                        <div class="flex items-center justify-between">
                            <span class="text-[10px] text-slate-500 font-black uppercase">æ€§åˆ«é€‰æ‹©</span>
                            <div class="flex bg-git-bg p-1 rounded-lg border border-git-border">
                                <button onclick="setGender('Male')" id="btn-male" class="px-4 py-1.5 rounded-md text-[10px] font-bold bg-git-blue text-white shadow-lg">ç”·</button>
                                <button onclick="setGender('Female')" id="btn-female" class="px-4 py-1.5 rounded-md text-[10px] font-bold text-slate-500">å¥³</button>
                            </div>
                        </div>
                        <div class="flex items-center justify-between pt-2 border-t border-git-border">
                            <span class="text-[10px] text-git-green font-black uppercase">æµå¹´å‘¨æœŸ (2026)</span>
                            <div id="flow-display" class="text-2xl font-black text-git-green">--</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å†³ç­–é›·è¾¾ç½—ç›˜ -->
            <section class="glass p-10 rounded-[3.5rem] flex flex-col items-center justify-center relative min-h-[600px] shadow-2xl">
                <div class="absolute top-10 left-12 flex items-center gap-3 opacity-20 no-print">
                    <i class="fa-solid fa-atom text-git-blue text-xl animate-spin-slow" style="animation-duration: 10s"></i>
                    <span class="text-[10px] font-mono tracking-[0.8em] uppercase">Universal_Logic_Radar</span>
                </div>

                <div class="radar-container">
                    <canvas id="radarChart"></canvas>
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div class="w-32 h-32 rounded-[2.5rem] bg-slate-900 border-4 border-git-border shadow-[0_0_60px_rgba(88,166,255,0.15)] flex flex-col items-center justify-center print:bg-white print:border-black">
                            <span class="text-[10px] font-mono text-slate-500 mb-1 uppercase tracking-widest">æ ¸å¿ƒ</span>
                            <span id="center-digit" class="text-7xl font-black text-white print:text-black">?</span>
                            <div class="h-0.5 w-12 bg-git-green my-2 opacity-30"></div>
                            <span class="text-[8px] font-bold text-git-blue tracking-tighter uppercase">Kernel</span>
                        </div>
                    </div>
                </div>

                <div class="mt-8 px-10 w-full no-print">
                    <div class="p-6 bg-git-bg/50 rounded-3xl border border-git-border flex items-center gap-6">
                        <div class="flex-1 space-y-2">
                            <h4 class="text-[10px] font-black text-git-blue uppercase tracking-widest">å®¡è®¡æç¤º (Audit Tips)</h4>
                            <p id="dynamic-tip" class="text-[11px] text-slate-400 leading-relaxed uppercase"></p>
                        </div>
                        <i class="fa-solid fa-lightbulb text-2xl text-git-green opacity-50"></i>
                    </div>
                </div>
            </section>

            <!-- æ·±åº¦å®¡è®¡æŠ¥å‘Š -->
            <section class="flex flex-col gap-8">
                <div class="flex justify-between items-center px-4 no-print">
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-wand-magic-sparkles text-purple-400"></i>
                        <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.4em]">Universal Auditor</h3>
                    </div>
                    <button onclick="compileStrategicReport()" id="compile-btn" class="px-14 py-5 bg-git-panel border border-git-border rounded-[2rem] text-xs font-black uppercase tracking-[0.2em] text-white hover:border-git-green hover:text-git-green transition-all active:scale-95 shadow-2xl">
                        <i class="fa-solid fa-microchip mr-3"></i> ç¼–è¯‘è¯¥å¯¹è±¡çš„æ·±åº¦å®¡è®¡æŠ¥å‘Š
                    </button>
                </div>
                
                <div id="report-output" class="hidden glass p-12 md:p-20 rounded-[4rem] shadow-2xl relative overflow-hidden print:border-none print:shadow-none">
                    <div id="markdown-container" class="prose prose-invert max-w-none print:text-black">
                        <!-- Markdown Content -->
                    </div>
                    <div class="mt-20 pt-10 border-t border-git-border flex justify-between items-center no-print text-slate-600 font-mono text-[9px] uppercase tracking-widest">
                        <span>ç¼–è¯‘æˆåŠŸ // æ—¶é—´: <span id="timestamp"></span></span>
                        <span>æ•°æ®æ¥æº: é€šç”¨ç”Ÿå‘½æ•°å­—ç³»ç»Ÿ</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- æ ¸å¿ƒçŠ¶æ€ ---
        const config = {
            targetYear: 2026,
            gender: 'Male',
            currentResults: {}
        };

        let radarInstance = null;

        // --- åˆå§‹åŒ– ---
        window.onload = () => {
            populateSelectors();
            refreshEngine();
        };

        function populateSelectors() {
            const y = document.getElementById('birthYear');
            const m = document.getElementById('birthMonth');
            const d = document.getElementById('birthDay');

            for (let i = 1950; i <= 2026; i++) {
                let opt = new Option(`${i} å¹´`, i);
                if (i === 1980) opt.selected = true;
                y.add(opt);
            }
            for (let i = 1; i <= 12; i++) {
                let opt = new Option(`${i} æœˆ`, i);
                if (i === 9) opt.selected = true;
                m.add(opt);
            }
            for (let i = 1; i <= 31; i++) {
                let opt = new Option(`${i} æ—¥`, i);
                if (i === 30) opt.selected = true;
                d.add(opt);
            }
        }

        // --- è®¡ç®—å¼•æ“ ---
        function reduceNum(n) {
            if (!n) return 0;
            let num = Math.abs(parseInt(n));
            while (num > 9) {
                num = String(num).split('').reduce((acc, curr) => acc + parseInt(curr), 0);
            }
            return num;
        }

        function refreshEngine() {
            const by = parseInt(document.getElementById('birthYear').value);
            const bm = parseInt(document.getElementById('birthMonth').value);
            const bd = parseInt(document.getElementById('birthDay').value);
            
            const dStr = String(bd).padStart(2, '0');
            const bmStr = String(bm).padStart(2, '0');
            const yrStr = String(by);

            const A = reduceNum(parseInt(dStr[0]) + parseInt(dStr[1]));
            const B = reduceNum(parseInt(bmStr[0]) + parseInt(bmStr[1]));
            const C = reduceNum(reduceNum(parseInt(yrStr[0]) + parseInt(yrStr[1])) + reduceNum(parseInt(yrStr[2]) + parseInt(yrStr[3])));
            
            const D = reduceNum(A + B);
            const E = reduceNum(B + C);
            const F = reduceNum(D + E);
            const I = reduceNum(D + F);
            const J = reduceNum(E + F);
            const K = reduceNum(I + J);
            const py = reduceNum(config.targetYear + reduceNum(bm) + reduceNum(bd));

            config.currentResults = { A, B, C, D, E, F, K, py, by, bm, bd };
            renderUI();
        }

        function updateProfileUI() {
            const name = document.getElementById('userName').value;
            const by = document.getElementById('birthYear').value;
            const bm = document.getElementById('birthMonth').value;
            const bd = document.getElementById('birthDay').value;
            document.getElementById('system-id').innerText = `ID: ${by}${bm}${bd} // BRANCH: UNIVERSAL`;
        }

        function renderUI() {
            const { A, B, C, D, E, F, K, py, by, bm, bd } = config.currentResults;

            document.getElementById('flow-display').innerText = py;
            document.getElementById('center-digit').innerText = F;
            document.getElementById('main-num-box').innerText = F;
            document.getElementById('root-num-box').innerText = K;
            updateProfileUI();

            const metrics = [
                { label: 'è¡ŒåŠ¨é¢‘ç‡ (Action)', val: A * 11, icon: 'fa-bolt-lightning' },
                { label: 'ç³»ç»Ÿé€»è¾‘ (Logic)', val: D * 11, icon: 'fa-layer-group' },
                { label: 'æ ¸å¿ƒåŠ¿èƒ½ (Apex)', val: F * 11, icon: 'fa-crown' },
                { label: 'é£æ§æƒé‡ (Risk)', val: py === 4 ? 98 : 55, icon: 'fa-shield-halved' },
                { label: 'åé•‡ç¨³å®šæ€§ (Foundation)', val: K * 11, icon: 'fa-anchor' }
            ];

            document.getElementById('metrics-stack').innerHTML = metrics.map(m => `
                <div class="space-y-2">
                    <div class="flex justify-between items-center text-[10px] font-black uppercase tracking-widest">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid ${m.icon} text-slate-500 w-4 text-center"></i>
                            <span class="text-slate-400">${m.label}</span>
                        </div>
                        <span class="text-git-blue font-mono">${m.val}%</span>
                    </div>
                    <div class="h-1 w-full bg-git-bg rounded-full overflow-hidden border border-git-border">
                        <div class="h-full bg-git-blue shadow-[0_0_10px_rgba(88,166,255,0.3)] transition-all duration-1000" style="width: ${m.val}%"></div>
                    </div>
                </div>
            `).join('');

            document.getElementById('dynamic-tip').innerText = `// å¯¹è±¡ä¸»æ€§æ ¼ä¸º ${F} å·ã€‚${py === 4 ? 'å½“å‰å¤„äºæ¶æ„æµå¹´ï¼Œå»ºè®®å»ºç«‹ç³»ç»Ÿæ€§é˜²å¾¡ã€‚' : 'å½“å‰æµå¹´å»ºè®®ä¿æŒåŠ¨æ€æ‰©å¼ ï¼Œå…³æ³¨æ ¸å¿ƒèŠ‚ç‚¹å˜åŒ–ã€‚'}`;

            renderRadar([A*11, D*11, F*11, C*11, B*11, py===4?98:50, K*11, 92]);
        }

        function renderRadar(data) {
            if (radarInstance) radarInstance.destroy();
            const ctx = document.getElementById('radarChart').getContext('2d');
            Chart.defaults.color = '#8b949e';
            Chart.defaults.font.family = 'JetBrains Mono, Microsoft YaHei';

            radarInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['è¡ŒåŠ¨', 'é€»è¾‘', 'æ ¸å¿ƒ', 'ç¯å¢ƒ', 'æ„Ÿå®˜', 'é£æ§', 'åé•‡', 'æ„¿æ™¯'],
                    datasets: [{
                        data: data,
                        backgroundColor: 'rgba(56, 139, 253, 0.1)',
                        borderColor: '#58a6ff',
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#58a6ff',
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            grid: { color: 'rgba(48, 54, 61, 0.5)' },
                            angleLines: { color: 'rgba(48, 54, 61, 0.8)' },
                            pointLabels: { font: { size: 12, weight: 'bold' } },
                            ticks: { display: false },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- AI å®¡è®¡æŠ¥å‘Šç¼–è¯‘ ---
        async function compileStrategicReport() {
            const btn = document.getElementById('compile-btn');
            const output = document.getElementById('report-output');
            const container = document.getElementById('markdown-container');
            const name = document.getElementById('userName').value;

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner animate-spin mr-3"></i> æ­£åœ¨æ¥å…¥æ³¢æˆ˜ç•¥å¤§è„‘';
            output.classList.remove('hidden');
            container.innerHTML = `<p class="animate-pulse text-git-blue mono uppercase tracking-widest text-center py-24">>>> æ­£åœ¨æ£€ç´¢ ${name} çš„å…¨æ¯æ¡£æ¡ˆ...<br>>>> æ­£åœ¨ç¼–è¯‘æ·±åº¦æˆ˜ç•¥å®¡è®¡è“å›¾...</p>`;

            const apiKey = ""; 
            const { A, B, C, D, E, F, K, py, by, bm, bd } = config.currentResults;
            
            const prompt = `ä½ æ˜¯æ³¢(Bo)ï¼Œä¸€ä½é«˜çº§æˆ˜ç•¥å®¡è®¡å¸ˆã€‚è¯·ä¸ºä»¥ä¸‹åˆ†æå¯¹è±¡æ’°å†™ä¸€ä»½ä¸å°‘äº2500å­—çš„ç”Ÿå‘½æ•°å­—æ·±åº¦æˆ˜ç•¥å®¡è®¡æŠ¥å‘Šï¼š
            - å¯¹è±¡å§“åï¼š${name}
            - æ€§åˆ«ï¼š${config.gender}
            - ç”Ÿæ—¥ï¼š${by}-${bm}-${bd}
            - ç”Ÿå‘½å‘¨æœŸï¼š2026å¹´å¤„äºæµå¹´æ•° ${py}
            - æ€§æ ¼æ ¸å¿ƒï¼šä¸»å‘½æ•° ${F}ï¼Œåé•‡åº•è•´ ${K}ï¼Œè¡ŒåŠ¨ä»£ç  ${A}
            
            æŠ¥å‘Šè¦æ±‚ï¼š
            1. é‡‡ç”¨ä¸“ä¸šä¸­æ–‡ Markdownã€‚
            2. ç»“æ„ï¼šæ€§æ ¼ä»£ç å®¡è®¡ã€2026æµå¹´åŠ¿èƒ½åˆ†æã€èŒä¸š/å•†ä¸šå»ºè®®ã€é£é™©é¢„é˜²ç­–ç•¥ã€2026å­£åº¦æ‰§è¡Œè·¯çº¿å›¾ã€‚
            3. è¯­æ°”ï¼šå•†ä¸šã€å†·å³»ã€ç©¿é€åŠ›å¼ºã€‚åˆ†æä¸ºä½•ä¸»å‘½æ•° ${F} åœ¨æµå¹´ ${py} ä¸­éœ€è¦ç‰¹åˆ«å…³æ³¨å“ªäº›å˜é‡ã€‚
            4. è¯·å‹¿æåŠçŒ«æˆ–å® ç‰©ç­‰ç§äººèƒŒæ™¯ï¼ˆé™¤éæ˜ç¡®è¦æ±‚ï¼‰ã€‚`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "ä½ æ˜¯ä¸€ä½ç²¾é€šç”Ÿå‘½å¯†ç ä¸å•†ä¸šåšå¼ˆçš„é«˜çº§å®¡è®¡å¸ˆã€‚" }] }
                    })
                });
                
                const data = await response.json();
                const result = data.candidates?.[0]?.content?.parts?.[0]?.text || "å®¡è®¡æµä¸­æ–­ï¼Œè¯·é‡è¯•ã€‚";
                
                container.innerHTML = marked.parse(result);
                document.getElementById('timestamp').innerText = new Date().toLocaleString();
                output.scrollIntoView({ behavior: 'smooth' });
                
            } catch (err) {
                container.innerHTML = `<p class="text-git-red font-mono text-center p-20">CRITICAL_EXCEPTION: ${err.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-rotate mr-2"></i> é‡æ–°ç¼–è¯‘å®¡è®¡æŠ¥å‘Š';
            }
        }

        // --- äº¤äº’å¤„ç† ---
        function setGender(g) {
            config.gender = g;
            document.getElementById('btn-male').className = g === 'Male' ? 'px-4 py-1.5 rounded-md text-[10px] font-bold bg-git-blue text-white shadow-lg transition-all' : 'px-4 py-1.5 rounded-md text-[10px] font-bold text-slate-500';
            document.getElementById('btn-female').className = g === 'Female' ? 'px-4 py-1.5 rounded-md text-[10px] font-bold bg-git-red text-white shadow-lg transition-all' : 'px-4 py-1.5 rounded-md text-[10px] font-bold text-slate-500';
            document.getElementById('gender-display').innerHTML = g === 'Male' ? '<i class="fa-solid fa-mars"></i>' : '<i class="fa-solid fa-venus text-git-red"></i>';
            refreshEngine();
        }

        function resetInputs() {
            document.getElementById('userName').value = "";
            document.getElementById('birthYear').value = 1990;
            document.getElementById('birthMonth').value = 1;
            document.getElementById('birthDay').value = 1;
            refreshEngine();
        }

        function shareWhatsApp() {
            const name = document.getElementById('userName').value;
            const res = config.currentResults;
            const msg = encodeURIComponent(
                `ğŸ“Š *${name} ç”Ÿå‘½æˆ˜ç•¥å®¡è®¡ç®€æŠ¥* ğŸ“Š\n` +
                `------------------------------------\n` +
                `ğŸ”¢ æ ¸å¿ƒä¸»å‘½: ${res.F} | åé•‡: ${res.K}\n` +
                `âš¡ 2026æµå¹´: ${res.py} (${res.py === 4 ? 'ç³»ç»Ÿæ¶æ„å¹´' : 'åŠ¨æ€æ¼”è¿›å¹´'})\n` +
                `>>> è¯¦ç»†é‡åŒ– PDF è¯·æŸ¥çœ‹é™„ä»¶ã€‚`
            );
            window.open(`https://wa.me/?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>
