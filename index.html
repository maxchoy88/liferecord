import React, { useState, useEffect, useMemo } from 'react';
import { 
  Zap, Shield, User, Heart, TrendingUp, 
  Crown, Compass, Briefcase, Share2, 
  Calculator, Sparkles, MessageSquare, Loader2, RefreshCw, 
  BarChart3, Settings, UserPlus, Info, Calendar,
  LineChart, Target, Edit3, Mars, Venus, Printer, MessageCircle,
  FileText, Activity, Hash, Binary, ChevronRight, Layout,
  PackageCheck, Hexagon, Binary as BinaryIcon, Gauge, Terminal,
  Code2, GitBranch, Github, Boxes
} from 'lucide-react';

/**
 * App - æˆ˜ç•¥çº§ç”Ÿå‘½å…¨æ¯ç»ˆç«¯ v3.9 (GitHub æ–¹ç¨‹å¼ç‰ˆ)
 * é€‚é…ï¼šé˜¿ç›› (Castor) | AI é¡¾é—®ï¼šæ³¢ (Bo)
 * æ ¸å¿ƒï¼šå°†ç”Ÿå‘½å¯†ç è½¬åŒ–ä¸ºå¼€å‘è€…é€»è¾‘ï¼Œå¼•å…¥ GitHub è´¡çŒ®çƒ­åŠ›å›¾ä¸ä»£ç åŒ–æ–¹ç¨‹å¼ã€‚
 */

const App = () => {
  // --- æ ¸å¿ƒè®¡ç®—å¼•æ“ (Pythagorean Algorithm) ---
  const reduceNum = (n) => {
    if (!n) return 0;
    let num = Math.abs(parseInt(n));
    while (num > 9) {
      num = String(num).split('').reduce((acc, curr) => acc + parseInt(curr), 0);
    }
    return num;
  };

  const calculateFullMatrix = (y, m, d, analysisYear) => {
    const dStr = String(d).padStart(2, '0');
    const mStr = String(m).padStart(2, '0');
    const yStr = String(y);
    
    const d1 = parseInt(dStr[0]) || 0; const d2 = parseInt(dStr[1]) || 0;
    const m1 = parseInt(mStr[0]) || 0; const m2 = parseInt(mStr[1]) || 0;
    const yr1 = parseInt(yStr[0]) || 0; const yr2 = parseInt(yStr[1]) || 0;
    const yr3 = parseInt(yStr[2]) || 0; const yr4 = parseInt(yStr[3]) || 0;

    const A = reduceNum(d1 + d2); 
    const B = reduceNum(m1 + m2); 
    const C = reduceNum(reduceNum(yr1 + yr2) + reduceNum(yr3 + yr4)); 
    const D = reduceNum(A + B); 
    const E = reduceNum(B + C); 
    const F = reduceNum(D + E); 
    const G = reduceNum(A + D); 
    const H = reduceNum(C + E); 
    const I = reduceNum(D + F); 
    const J = reduceNum(E + F); 
    const K = reduceNum(I + J); 

    const personalYear = reduceNum(parseInt(analysisYear) + reduceNum(m) + reduceNum(d));

    // æ•°æ®åŒ–é›·è¾¾æŒ‡æ ‡
    const metrics = [
      { label: 'Core Energy', val: F * 11, color: 'bg-indigo-500' },
      { label: 'Strategic Logic', val: D * 11, color: 'bg-emerald-500' },
      { label: 'Execution Speed', val: A * 11, color: 'bg-rose-500' },
      { label: 'Environment', val: C * 11, color: 'bg-cyan-500' },
      { label: 'Emotional Sync', val: B * 11, color: 'bg-amber-500' },
      { label: 'Risk Control', val: personalYear === 4 ? 92 : 55, color: 'bg-blue-500' },
      { label: 'Future Upside', val: H * 11, color: 'bg-purple-500' },
      { label: 'Root Sitting', val: K * 11, color: 'bg-orange-500' }
    ];

    // ä»£ç åŒ–å±•ç¤º
    const codeSnippet = `
// Castor Life Matrix Logic v3.9
const LifeMatrix = {
  profile: "${y}-${m}-${d}",
  apex: ${F}, // ä¸»å‘½æ•°
  sitting: ${K}, // åé•‡ç 
  cycle: ${personalYear}, // ${analysisYear}æµå¹´
  getStrategy: () => {
    if (cycle === 4) return "STRUCTURAL_BUILD";
    return "AGILE_REFACTOR";
  }
};`;

    return { A, B, C, D, E, F, G, H, I, J, K, personalYear, metrics, codeSnippet };
  };

  // --- çŠ¶æ€ç®¡ç† ---
  const [profile, setProfile] = useState({
    name: 'Castor é˜¿ç››',
    gender: 'Male',
    birthYear: 1980,
    birthMonth: 9,
    birthDay: 30,
    targetYear: 2026 
  });
  
  const [isEditingName, setIsEditingName] = useState(false);
  const [aiLoading, setAiLoading] = useState(false);
  const [aiResponse, setAiResponse] = useState('');
  const [chatInput, setChatInput] = useState('');

  const results = useMemo(() => {
    return calculateFullMatrix(profile.birthYear, profile.birthMonth, profile.birthDay, profile.targetYear);
  }, [profile.birthYear, profile.birthMonth, profile.birthDay, profile.targetYear]);

  const flowYears = [2024, 2025, 2026, 2027, 2028, 2029, 2030];
  const birthYears = Array.from({ length: 80 }, (_, i) => 1950 + i);
  const months = Array.from({ length: 12 }, (_, i) => i + 1);
  const days = Array.from({ length: 31 }, (_, i) => i + 1);

  // --- AI ä¸ é€»è¾‘å‡½æ•° ---
  const callGemini = async (prompt, systemPrompt = "") => {
    setAiLoading(true);
    const apiKey = ""; 
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
    try {
      const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }],
          systemInstruction: { parts: [{ text: systemPrompt }] }
        })
      });
      const data = await response.json();
      const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
      setAiResponse(typeof text === 'object' ? JSON.stringify(text) : String(text || ""));
    } catch (err) { setAiResponse(`[SYSTEM_ERROR]: ${err.message}`); }
    finally { setAiLoading(false); }
  };

  const handleChat = () => {
    if (!chatInput.trim() || !results) return;
    const prompt = `[CASTOR_QUERY]: ${chatInput}. Context: Main ${results.F}, Root ${results.K}, Year ${profile.targetYear}.`;
    callGemini(prompt, "ä½ æ˜¯ä¸€ä½é¡¶å°–çš„æˆ˜ç•¥åˆ†æå¸ˆæ³¢ (Bo)ï¼Œè¯·ä»¥ç»“æ„åŒ–çš„æ–¹å¼å›ç­”ã€‚");
    setChatInput('');
  };

  const handleAiAnalyze = () => {
    const prompt = `è¯·åŸºäº GitHub æ–¹ç¨‹å¼é€»è¾‘åˆ†æ 1980-09-30 ç”·æ€§çš„å…¨æ¯å‘½ç›˜ã€‚æµå¹´ 4 å¯¹å…¶ 2026 å¹´é’è®­å¼€å·¥çš„å½±å“ï¼Œä»¥åŠ Money (ç‹¸èŠ±çŒ«) å¦‚ä½•ä½œä¸ºæƒ…ç»ª Bufferã€‚`;
    callGemini(prompt, "è¯·æä¾›ä¸€ä»½å¸¦æœ‰ä»£ç å—é£æ ¼å’Œ Git Log é£æ ¼çš„æˆ˜ç•¥æŠ¥å‘Šã€‚");
  };

  const handleWhatsAppShare = () => {
    const message = encodeURIComponent(
      `ğŸ‘¨â€ğŸ’» *CASTOR MATRIX LOGS* v3.9\n` +
      `-----------------------------------\n` +
      `ğŸ“¦ Repo: Life-Matrix-0930\n` +
      `ğŸ”¢ Main_Node: ${results.F} | Sitting_Core: ${results.K}\n` +
      `âš¡ Year_Status: ${results.personalYear} (Structural_Phase)\n` +
      `-----------------------------------\n` +
      `>>> æŠ¥å‘Šå·²ç”± Bo AI ç¼–è¯‘å®Œæˆã€‚`
    );
    window.open(`https://wa.me/?text=${message}`, '_blank');
  };

  // --- GitHub é£æ ¼è¾…åŠ© ---
  const getOctagonPoints = (cx, cy, r) => {
    let pts = [];
    for (let i = 0; i < 8; i++) {
      let angle = (i * 45 - 90) * (Math.PI / 180);
      pts.push(`${cx + r * Math.cos(angle)},${cy + r * Math.sin(angle)}`);
    }
    return pts.join(' ');
  };

  const getRadarPoints = (cx, cy, maxR, metrics) => {
    let pts = [];
    metrics.forEach((m, i) => {
      let r = (m.val / 100) * maxR;
      let angle = (i * 45 - 90) * (Math.PI / 180);
      pts.push(`${cx + r * Math.cos(angle)},${cy + r * Math.sin(angle)}`);
    });
    return pts.join(' ');
  };

  return (
    <div className="min-h-screen bg-[#0d1117] text-[#c9d1d9] p-4 md:p-8 font-sans selection:bg-[#238636] selection:text-white antialiased">
      <div className="max-w-6xl mx-auto flex flex-col gap-6">
        
        {/* Header - GitHub Style */}
        <div className="flex justify-between items-center border-b border-[#30363d] pb-6 no-print">
          <div className="flex items-center gap-4">
            <div className="p-3 bg-[#161b22] border border-[#30363d] rounded-xl text-[#58a6ff]">
              <Github size={24} />
            </div>
            <div>
              <h1 className="text-xl font-bold text-white flex items-center gap-2">
                castor-life-matrix <span className="text-xs font-normal border border-[#30363d] px-2 py-0.5 rounded-full text-[#8b949e]">Public</span>
              </h1>
              <p className="text-xs text-[#8b949e] font-mono mt-1 uppercase tracking-tighter italic">master / equation-v3.9-stable</p>
            </div>
          </div>
          <div className="flex gap-2">
            <button onClick={handleWhatsAppShare} className="flex items-center gap-2 px-4 py-2 bg-[#21262d] border border-[#30363d] rounded-lg text-sm font-semibold hover:bg-[#30363d] transition-all">
              <Share2 size={14} className="text-[#58a6ff]"/> Share
            </button>
            <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 bg-[#238636] border border-[#2ea44f] text-white rounded-lg text-sm font-semibold hover:bg-[#2ea44f] transition-all">
              <Printer size={14} /> Export Report
            </button>
            <button onClick={() => setIsEditingName(!isEditingName)} className="p-2.5 bg-[#21262d] border border-[#30363d] rounded-lg text-[#8b949e] hover:text-white">
              <Edit3 size={18} />
            </button>
          </div>
        </div>

        {/* æ‰“å°ä¸“ç”¨ */}
        <div className="hidden only-print text-center border-b border-slate-900 pb-10 mb-10">
          <h1 className="text-3xl font-black text-black uppercase tracking-widest">CASTOR STRATEGIC LOGS (MATRIX V3.9)</h1>
          <p className="text-sm font-mono mt-2 text-slate-600 italic">"Algorithmic Approach to Personal Flow Control"</p>
        </div>

        {/* æ§åˆ¶ä¸­å¿ƒ */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 no-print">
          {/* å·¦ï¼šå‚æ•° */}
          <div className="lg:col-span-8 bg-[#161b22] p-6 rounded-2xl border border-[#30363d]">
             <div className="flex justify-between items-center mb-6">
                <div className="flex items-center gap-2 text-white font-bold text-xs uppercase tracking-widest"><Terminal size={14} className="text-[#8b949e]"/> Input Parameters</div>
                <div className="flex bg-[#0d1117] p-1 rounded-lg border border-[#30363d]">
                  <button onClick={() => setProfile({...profile, gender: 'Male'})} className={`px-4 py-1.5 rounded-md text-[10px] font-bold transition-all ${profile.gender === 'Male' ? 'bg-[#58a6ff] text-white' : 'text-[#8b949e]'}`}>MALE</button>
                  <button onClick={() => setProfile({...profile, gender: 'Female'})} className={`px-4 py-1.5 rounded-md text-[10px] font-bold transition-all ${profile.gender === 'Female' ? 'bg-[#f85149] text-white' : 'text-[#8b949e]'}`}>FEMALE</button>
                </div>
             </div>
             <div className="grid grid-cols-3 gap-3 mb-6">
                {['Year', 'Month', 'Day'].map((label, i) => (
                  <select key={label} value={profile[i === 0 ? 'birthYear' : i === 1 ? 'birthMonth' : 'birthDay']} onChange={(e) => setProfile({...profile, [i === 0 ? 'birthYear' : i === 1 ? 'birthMonth' : 'birthDay']: parseInt(e.target.value)})} className="bg-[#0d1117] border border-[#30363d] rounded-xl p-3 text-sm font-black text-white focus:border-[#58a6ff] outline-none">
                    {[birthYears, months, days][i].map(o => <option key={o} value={o}>{o}</option>)}
                  </select>
                ))}
             </div>
             <div className="flex gap-2 overflow-x-auto no-scrollbar pt-4 border-t border-[#30363d]">
                {flowYears.map(y => (
                  <button key={y} onClick={() => setProfile({...profile, targetYear: y})} className={`shrink-0 px-5 py-2 rounded-lg text-xs font-black transition-all border ${profile.targetYear === y ? 'bg-[#388bfd]/20 border-[#388bfd] text-[#58a6ff]' : 'bg-[#0d1117] border-[#30363d] text-[#8b949e]'}`}>{y}</button>
                ))}
             </div>
          </div>
          {/* å³ï¼šæµå¹´ Commit */}
          <div className="lg:col-span-4 bg-[#161b22] p-6 rounded-2xl border border-[#30363d] flex flex-col justify-center items-center">
            <span className="text-[10px] font-bold text-[#8b949e] uppercase mb-2">Cycle Commit Intensity</span>
            <div className="text-7xl font-black text-[#58a6ff] tracking-tighter mb-2">{results.personalYear}</div>
            <div className="text-[10px] font-mono text-[#3fb950] bg-[#3fb950]/10 px-3 py-1 rounded-full">+ Structural Build Active</div>
          </div>
        </div>

        {/* æ ¸å¿ƒæŠ¥å‘Šå±‚ */}
        <div id="report-content" className="grid grid-cols-1 lg:grid-cols-12 gap-6 items-stretch">
          
          {/* å·¦ï¼šä»£ç åŒ–æ‘˜è¦ */}
          <div className="lg:col-span-4 flex flex-col gap-6">
            <div className="bg-[#161b22] p-6 rounded-2xl border border-[#30363d] print:bg-white print:border-slate-300 print:text-black">
               <div className="flex items-center gap-3 mb-6 pb-6 border-b border-[#30363d] print:border-slate-200">
                 <div className="w-12 h-12 rounded-xl bg-[#0d1117] flex items-center justify-center border border-[#30363d] print:bg-slate-100">
                   {profile.gender === 'Male' ? <Mars className="text-[#58a6ff]" size={24}/> : <Venus className="text-[#f85149]" size={24}/>}
                 </div>
                 <div className="flex-1">
                    {isEditingName ? <input type="text" value={profile.name} onChange={(e) => setProfile({...profile, name: e.target.value})} onBlur={() => setIsEditingName(false)} className="bg-black border border-[#58a6ff] rounded px-2 py-1 text-lg font-black text-white w-full" autoFocus /> : <h2 className="text-xl font-bold text-white print:text-black">{profile.name}</h2>}
                    <p className="text-[9px] text-[#8b949e] font-mono uppercase mt-1 tracking-widest leading-none">Branch: main / Profile-ID: 0930</p>
                 </div>
               </div>
               <div className="space-y-4">
                  <div className="p-4 bg-[#0d1117] rounded-xl border border-[#30363d] print:bg-slate-50">
                    <div className="flex items-center gap-2 text-[9px] font-bold text-[#8b949e] uppercase mb-3"><Hash size={10}/> Matrix Constants</div>
                    <div className="grid grid-cols-2 gap-4">
                       <div className="flex flex-col">
                         <span className="text-[8px] text-[#8b949e]">APEX_FACTOR</span>
                         <span className="text-2xl font-black text-[#58a6ff]">{results.F}</span>
                       </div>
                       <div className="flex flex-col border-l border-[#30363d] pl-4">
                         <span className="text-[8px] text-[#8b949e]">SITTING_CORE</span>
                         <span className="text-2xl font-black text-[#f85149]">{results.K}</span>
                       </div>
                    </div>
                  </div>
                  
                  {/* ä»£ç å—æ–¹ç¨‹å¼ */}
                  <div className="relative group">
                    <div className="absolute top-2 right-3 text-[8px] text-[#8b949e] uppercase">Source Logic</div>
                    <pre className="p-4 bg-[#0d1117] rounded-xl border border-[#30363d] text-[10px] font-mono leading-relaxed overflow-x-auto print:bg-slate-100 print:text-black">
                      <code className="text-[#79c0ff]">const</code> <code className="text-[#d2a8ff]">Equation</code> = {"{\n"}
                      {"  "}A: <code className="text-[#ff7b72]">{results.A}</code>, <code className="text-[#8b949e]">// Root</code>{"\n"}
                      {"  "}B: <code className="text-[#ff7b72]">{results.B}</code>, <code className="text-[#8b949e]">// Emotion</code>{"\n"}
                      {"  "}D: <code className="text-[#ff7b72]">{results.D}</code>, <code className="text-[#8b949e]">// Process</code>{"\n"}
                      {"  "}sitting: <code className="text-[#ff7b72]">{results.K}</code>{"\n"}
                      {"}"};
                    </pre>
                  </div>
               </div>
            </div>

            {/* Money Balance Module */}
            <div className="bg-[#161b22] p-6 rounded-2xl border border-[#30363d] print:bg-white print:border-slate-300">
               <div className="flex items-center gap-2 mb-4 text-[#f85149]">
                  <Boxes size={16}/>
                  <span className="text-[10px] font-black uppercase tracking-widest text-[#8b949e]">Stability Buffer: Money</span>
               </div>
               <p className="text-[11px] leading-[1.7] text-[#8b949e] print:text-slate-700">
                 3 å·äººçš„ç›´è§‰æå¿«ä½†æ˜“äº§ç”Ÿâ€œååŒ…â€ã€‚Money (ç‹¸èŠ±çŒ«) çš„å¹³ç¨³ç”Ÿå‘½ç‰¹å¾å¯è§†ä¸º **Biological Noise Cancellation**ã€‚åœ¨ U13 é¡¹ç›®å†³ç­–ä¸ 4 å·æµå¹´å¤ç›˜æ—¶ï¼Œå»ºè®®è¿›è¡Œäº’åŠ¨ä»¥é”šå®šæƒ…ç»ªã€‚
               </p>
            </div>
          </div>

          {/* å³ï¼šå…«è§’å…¨æ¯æ•°æ®é›·è¾¾ (GitHub é£æ ¼) */}
          <div className="lg:col-span-8 bg-[#161b22] p-8 rounded-2xl border border-[#30363d] flex flex-col items-center justify-center relative print:bg-white print:border-slate-300 print:text-black">
            <div className="absolute top-6 left-8 flex items-center gap-2 opacity-40">
               <Code2 size={16} className="text-[#3fb950]"/>
               <span className="text-[10px] font-mono tracking-widest">HOLOGRAPHIC_RADAR_ENGINE</span>
            </div>

            <div className="relative w-[450px] h-[450px] flex items-center justify-center mt-6">
              <svg className="absolute inset-0 w-full h-full overflow-visible opacity-30" viewBox="0 0 100 100">
                <defs>
                   <linearGradient id="gitGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                     <stop offset="0%" stopColor="#388bfd" />
                     <stop offset="100%" stopColor="#3fb950" />
                   </linearGradient>
                </defs>
                <polygon points={getOctagonPoints(50, 50, 48)} fill="none" stroke="#30363d" strokeWidth="0.5" />
                <polygon points={getOctagonPoints(50, 50, 36)} fill="none" stroke="#30363d" strokeWidth="0.2" />
                <polygon points={getOctagonPoints(50, 50, 24)} fill="none" stroke="#30363d" strokeWidth="0.1" />
                {/* é›·è¾¾é¢ */}
                <polygon points={getRadarPoints(50, 50, 48, results.metrics)} fill="url(#gitGrad)" fillOpacity="0.1" stroke="url(#gitGrad)" strokeWidth="1.2" className="transition-all duration-700" />
              </svg>

              {/* æ ¸å¿ƒ Apex */}
              <div className="absolute z-10">
                 <div className={`w-32 h-32 rounded-[2.5rem] bg-[#0d1117] flex flex-col items-center justify-center text-white border-4 border-[#30363d] shadow-[0_0_50px_rgba(56,139,253,0.3)] print:bg-white print:text-black print:shadow-none print:border-slate-900`}>
                   <span className="text-[10px] font-mono text-[#8b949e] mb-1">MAIN_TRAIT</span>
                   <span className="text-6xl font-black leading-none">{results.F}</span>
                   <span className="text-[10px] font-bold text-[#58a6ff] mt-2 tracking-widest uppercase">Apex.Exec()</span>
                 </div>
              </div>

              {/* å…«è§’æ ‡ç­¾ */}
              {results.metrics.map((m, i) => {
                const a = (i * 45 - 90) * (Math.PI / 180);
                return (
                  <div key={i} className="absolute flex flex-col items-center" style={{ left: `${50 + 58 * Math.cos(a)}%`, top: `${50 + 58 * Math.sin(a)}%` }}>
                    <span className="text-[9px] font-bold text-[#8b949e] uppercase mb-0.5">{m.label}</span>
                    <span className="text-xs font-black text-white print:text-black">{m.val}</span>
                  </div>
                );
              })}
            </div>

            {/* GitHub è´¡çŒ®é£æ ¼ç»Ÿè®¡æ  */}
            <div className="mt-20 w-full pt-10 border-t border-[#30363d] flex flex-col gap-6 print:border-slate-300">
               <div className="flex items-center justify-between px-2">
                 <span className="text-[10px] font-bold text-[#8b949e] uppercase">Matrix Contribution Graph</span>
                 <div className="flex gap-1 items-center">
                    <span className="text-[8px] text-[#8b949e]">Less</span>
                    <div className="flex gap-1">
                      {[1, 2, 3, 4, 5].map(i => <div key={i} className={`w-3 h-3 rounded-sm ${i === 1 ? 'bg-[#161b22]' : i === 2 ? 'bg-[#0e4429]' : i === 3 ? 'bg-[#006d32]' : i === 4 ? 'bg-[#26a641]' : 'bg-[#39d353]'}`}></div>)}
                    </div>
                    <span className="text-[8px] text-[#8b949e]">More</span>
                 </div>
               </div>
               <div className="grid grid-cols-2 gap-10">
                  <div className="flex gap-4">
                    <GitBranch size={20} className="text-[#3fb950] shrink-0 mt-1"/>
                    <div>
                      <h4 className="text-[11px] font-bold text-white mb-1">Feature: Structural Logic</h4>
                      <p className="text-[10px] text-[#8b949e] leading-relaxed italic">
                        2026 å¹´ï¼ˆæµå¹´ 4ï¼‰æ˜¯æ‚¨çš„â€œæ¶æ„å¤§ç‰ˆæœ¬â€ã€‚U13 é¡¹ç›®çš„ä»£ç å·²ç»å†™å¥½ï¼Œç°åœ¨éœ€è¦è¿›è¡Œâ€œå•å…ƒæµ‹è¯•â€ä¸â€œæ³•å¾‹è¾¹ç•Œç¡®è®¤â€ã€‚
                      </p>
                    </div>
                  </div>
                  <div className="flex gap-4 border-l border-[#30363d] pl-8">
                    <Zap size={20} className="text-[#58a6ff] shrink-0 mt-1"/>
                    <div>
                      <h4 className="text-[11px] font-bold text-white mb-1">Commit: Execution Intensity</h4>
                      <p className="text-[10px] text-[#8b949e] leading-relaxed italic">
                        ä¸»å‘½æ•° 3 å·èµ‹äºˆäº†æ‚¨é«˜é¢‘ç‡çš„ Commit èƒ½åŠ›ã€‚åœ¨è‚¡ç¥¨å¸‚åœºä¸­ï¼Œå»ºè®®å‡å°‘â€œçƒ­è¡¥ä¸â€æ“ä½œï¼Œä»¥ç¨³å¥çš„é•¿çº¿ Merge ä¸ºä¸»ã€‚
                      </p>
                    </div>
                  </div>
               </div>
            </div>
          </div>
        </div>

        {/* æˆ˜ç•¥ Log è¾“å‡ºåŒºåŸŸ */}
        <div className="flex flex-col gap-6 no-print">
           <div className="flex justify-between items-center">
              <h3 className="text-[10px] font-bold text-[#8b949e] uppercase tracking-[0.4em] flex items-center gap-2"><Activity size={14} className="text-[#58a6ff]"/> Git Strategic Log Analysis</h3>
              <button onClick={handleAiAnalyze} disabled={aiLoading} className="px-6 py-2.5 bg-[#21262d] hover:bg-[#30363d] border border-[#30363d] text-white rounded-lg text-[10px] font-bold uppercase tracking-widest flex items-center gap-2 shadow-lg">
                {aiLoading ? <Loader2 className="animate-spin" size={14}/> : <Terminal size={14}/>} Compile Analytics
              </button>
           </div>

           {aiResponse && (
             <div className="bg-[#161b22] p-10 rounded-2xl border border-[#30363d] shadow-2xl relative overflow-hidden print:bg-white print:text-black">
                <div className="flex items-center gap-2 mb-6 text-[#58a6ff] pb-4 border-b border-[#30363d]">
                   <FileText size={20}/>
                   <span className="text-sm font-black uppercase tracking-widest">Bo: master-report.md</span>
                </div>
                <div className="text-[14px] text-[#c9d1d9] leading-[1.9] border-l-4 border-[#30363d] pl-10 print:text-slate-800 print:border-slate-300 font-mono italic whitespace-pre-wrap print:font-sans print:not-italic">
                   {aiResponse}
                </div>
             </div>
           )}
        </div>

        {/* Command Terminal */}
        <div className="bg-[#0d1117] p-8 rounded-2xl border border-[#30363d] shadow-2xl no-print">
          <div className="flex items-center gap-2 mb-6">
            <div className="flex gap-1.5">
              <div className="w-3 h-3 rounded-full bg-[#ff5f56]"></div>
              <div className="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
              <div className="w-3 h-3 rounded-full bg-[#27c93f]"></div>
            </div>
            <span className="text-[10px] font-mono text-[#8b949e] ml-3">/users/castor/bo-ai-assistant --exec</span>
          </div>
          <div className="flex gap-4">
            <span className="text-[#58a6ff] font-bold mt-4">$</span>
            <input 
              type="text" 
              value={chatInput}
              onChange={(e) => setChatInput(e.target.value)}
              placeholder="è¾“å…¥åˆ†ææŒ‡ä»¤ï¼Œä¾‹å¦‚: git analyse --stock SUNCON --year 2026"
              className="flex-grow bg-transparent border-none py-4 text-sm font-mono text-white focus:ring-0 outline-none placeholder:text-[#484f58]"
              onKeyDown={(e) => e.key === 'Enter' && handleChat()}
            />
            <button onClick={handleChat} disabled={aiLoading || !chatInput.trim()} className="px-8 bg-[#238636] hover:bg-[#2ea44f] text-white rounded-lg font-bold text-xs uppercase tracking-widest transition-all">
              {aiLoading ? <Loader2 className="animate-spin" size={16} /> : 'RUN'}
            </button>
          </div>
        </div>

        {/* Footer */}
        <div className="text-center pb-12 opacity-20 print:border-t print:pt-10 print:mt-12 print:opacity-100 print:text-slate-400">
          <p className="text-[9px] uppercase tracking-[0.6em] font-mono">Bo Matrix Engine â€¢ Strategic Intelligence â€¢ Created by Castor Limited</p>
        </div>
      </div>
      
      <style>{`
        @media print {
          body { background-color: white !important; color: black !important; padding: 0 !important; }
          .no-print { display: none !important; }
          .only-print { display: block !important; }
          .min-h-screen { min-height: auto !important; background: white !important; padding: 0 !important; }
          .max-w-6xl { max-width: 100% !important; margin: 0 !important; padding: 15px !important; }
          #report-content { display: grid !important; }
          svg polygon { stroke: #ccc !important; opacity: 0.5 !important; }
          page-break-inside: avoid;
        }
        .only-print { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
      `}</style>
    </div>
  );
};

export default App;
