<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>é˜¿ç››æˆ˜ç•¥æ“ä½œç³»ç»Ÿ | ç»ˆç«¯ v7.2 (æµæ§åŠ å›ºç‰ˆ)</title>
    <!-- æ ¸å¿ƒç»„ä»¶åº“ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'git-bg': '#0d1117',
                        'git-panel': '#161b22',
                        'git-border': '#30363d',
                        'git-blue': '#58a6ff',
                        'git-green': '#3fb950',
                        'git-red': '#f85149'
                    },
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                        sans: ['Inter', 'Microsoft YaHei', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Inter', 'Microsoft YaHei', sans-serif; scroll-behavior: smooth; }
        .glass { background: rgba(22, 27, 34, 0.95); backdrop-filter: blur(20px); border: 1px solid #30363d; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* æ·±åº¦å®¡è®¡æŠ¥å‘Šæ’ç‰ˆ */
        .prose h1 { font-size: 2rem; font-weight: 900; color: #58a6ff; border-bottom: 2px solid #30363d; padding-bottom: 0.5rem; margin-bottom: 2rem; }
        .prose h2 { font-size: 1.5rem; font-weight: 800; color: #3fb950; margin-top: 2.5rem; margin-bottom: 1.2rem; border-left: 5px solid #3fb950; padding-left: 1rem; }
        .prose p { line-height: 2.2; margin-bottom: 1.5rem; text-align: justify; color: #acbac7; font-size: 1.05rem; }
        .prose strong { color: #fff; background: rgba(56, 139, 253, 0.15); padding: 0 4px; border-radius: 4px; }
        .prose blockquote { border-left: 4px solid #58a6ff; padding: 1.5rem; font-style: italic; color: #8b949e; background: #161b22; border-radius: 0 0.5rem 0.5rem 0; }
        .prose ul { list-style-type: square; margin-left: 2rem; margin-bottom: 2rem; color: #acbac7; }

        @media print {
            .no-print { display: none !important; }
            body { background: white !important; color: black !important; padding: 0 !important; }
            .glass { background: white !important; border: 1px solid #ddd !important; box-shadow: none !important; color: black !important; }
            .prose h1, .prose h2 { color: black !important; border-bottom: 2px solid black !important; }
            .prose p, .prose li { color: #111 !important; }
        }
        
        .radar-container { position: relative; width: 100%; max-width: 500px; height: 450px; margin: 0 auto; }
        .loader-dots::after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body class="p-2 md:p-8 min-h-screen">

    <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
    <header class="max-w-7xl mx-auto mb-10 flex justify-between items-center border-b border-git-border pb-8 no-print">
        <div class="flex items-center gap-6">
            <div class="p-4 bg-git-panel border border-git-border rounded-2xl shadow-2xl">
                <i class="fa-solid fa-microchip text-3xl text-git-blue animate-pulse"></i>
            </div>
            <div>
                <div class="flex items-center gap-3">
                    <h1 class="text-3xl font-black text-white tracking-tighter uppercase italic">Castor Strategic Audit</h1>
                    <span class="px-2 py-0.5 bg-git-blue/10 text-git-blue text-[9px] font-bold border border-git-blue/20 rounded uppercase tracking-widest">v7.2 Stable</span>
                </div>
                <p class="text-[10px] text-slate-500 font-mono tracking-[0.3em] mt-1 uppercase">å†…æ ¸è‡ªæ„ˆæœºåˆ¶å·²æŒ‚è½½ // é€»è¾‘é¡¾é—®ï¼šæ³¢ (Bo)</p>
            </div>
        </div>
        <div class="flex gap-4">
            <button onclick="shareWhatsApp()" class="flex items-center gap-2 px-6 py-3 bg-git-panel border border-git-border rounded-xl text-xs font-black uppercase hover:border-git-green transition-all shadow-lg">
                <i class="fa-brands fa-whatsapp text-git-green text-lg"></i> <span>æŠ¥å‘Šå¯¼è¯»</span>
            </button>
            <button onclick="window.print()" class="flex items-center gap-2 px-6 py-3 bg-git-green text-white rounded-xl text-xs font-black uppercase shadow-xl hover:brightness-105 active:scale-95 transition-all">
                <i class="fa-solid fa-print"></i> <span>å¯¼å‡º PDF</span>
            </button>
        </div>
    </header>

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- å·¦ä¾§ï¼šèº«ä»½ä¸å®æ—¶é‡åŒ– -->
        <aside class="lg:col-span-4 space-y-6">
            <div class="glass p-8 rounded-[2.5rem] shadow-2xl relative overflow-hidden h-full">
                <div class="absolute -top-12 -right-12 opacity-5 pointer-events-none">
                    <i class="fa-solid fa-fingerprint text-[12rem]"></i>
                </div>
                
                <div class="flex items-center gap-5 mb-10 pb-8 border-b border-git-border">
                    <div id="gender-display" class="w-20 h-20 rounded-3xl bg-git-bg border border-git-border flex items-center justify-center text-4xl shadow-inner text-git-blue">
                        <i class="fa-solid fa-user-secret"></i>
                    </div>
                    <div class="flex-1">
                        <input type="text" id="userName" value="é˜¿ç›› (Castor)" oninput="updateProfileUI()" class="bg-transparent border-b border-git-border w-full text-2xl font-black text-white focus:border-git-blue outline-none py-1 mb-2">
                        <p id="system-id" class="text-[10px] text-slate-500 font-mono uppercase tracking-[0.2em]"></p>
                    </div>
                </div>

                <!-- æ ¸å¿ƒæ•°å­—å±•ç¤º -->
                <div class="grid grid-cols-2 gap-4 mb-10">
                    <div class="bg-git-bg p-5 rounded-2xl border border-git-border text-center">
                        <span class="text-[9px] font-black text-slate-500 uppercase block mb-1">ä¸»å‘½ (Apex)</span>
                        <span id="main-num-box" class="text-3xl font-black text-git-blue">--</span>
                    </div>
                    <div class="bg-git-bg p-5 rounded-2xl border border-git-border text-center">
                        <span class="text-[9px] font-black text-slate-500 uppercase block mb-1">åé•‡ (Root)</span>
                        <span id="root-num-box" class="text-3xl font-black text-git-green">--</span>
                    </div>
                </div>

                <div id="metrics-stack" class="space-y-8">
                    <!-- Metrics dynamic injection -->
                </div>

                <div class="mt-12 pt-8 border-t border-git-border">
                    <button onclick="resetSystem()" class="w-full py-4 bg-git-bg hover:bg-git-red/10 border border-git-border rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-git-red transition-all">
                        <i class="fa-solid fa-power-off mr-2"></i> é‡ç½®å¹¶æ¸…é™¤ç¼“å­˜
                    </button>
                </div>
            </div>
        </aside>

        <!-- ä¸»ç•Œé¢ï¼šç½—ç›˜ä¸å®¡è®¡è¾“å‡º -->
        <main class="lg:col-span-8 space-y-8">
            <!-- æ•°æ®è¾“å…¥é¢æ¿ -->
            <section class="glass p-8 rounded-[2rem] shadow-xl no-print">
                <div class="grid grid-cols-1 md:grid-cols-12 gap-8 items-center">
                    <div class="md:col-span-8 grid grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="text-[10px] text-slate-500 font-black uppercase tracking-widest ml-1">å‡ºç”Ÿå¹´ä»½</label>
                            <select id="birthYear" onchange="refreshEngine()" class="w-full bg-git-bg border border-git-border rounded-xl p-4 text-sm font-black text-white focus:border-git-blue outline-none cursor-pointer"></select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] text-slate-500 font-black uppercase tracking-widest ml-1">å‡ºç”Ÿæœˆä»½</label>
                            <select id="birthMonth" onchange="refreshEngine()" class="w-full bg-git-bg border border-git-border rounded-xl p-4 text-sm font-black text-white focus:border-git-blue outline-none cursor-pointer"></select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] text-slate-500 font-black uppercase tracking-widest ml-1">å‡ºç”Ÿæ—¥æœŸ</label>
                            <select id="birthDay" onchange="refreshEngine()" class="w-full bg-git-bg border border-git-border rounded-xl p-4 text-sm font-black text-white focus:border-git-blue outline-none cursor-pointer"></select>
                        </div>
                    </div>
                    <div class="md:col-span-4 flex flex-col gap-4">
                        <div class="flex items-center justify-between">
                            <span class="text-[10px] text-slate-500 font-black uppercase">æ€§åˆ«ç¯å¢ƒ</span>
                            <div class="flex bg-git-bg p-1 rounded-lg border border-git-border">
                                <button onclick="setGender('Male')" id="btn-male" class="px-5 py-1.5 rounded-md text-[10px] font-bold bg-git-blue text-white transition-all">ç”·</button>
                                <button onclick="setGender('Female')" id="btn-female" class="px-5 py-1.5 rounded-md text-[10px] font-bold text-slate-500 transition-all">å¥³</button>
                            </div>
                        </div>
                        <div class="flex items-center justify-between pt-2 border-t border-git-border">
                            <span class="text-[10px] text-git-green font-black uppercase tracking-tighter">2026 æµå¹´åŠ¿èƒ½</span>
                            <div id="flow-display" class="text-3xl font-black text-git-green leading-none">--</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å†³ç­–çŸ©é˜µé›·è¾¾ -->
            <section class="glass p-10 rounded-[3.5rem] flex flex-col items-center justify-center relative min-h-[600px] shadow-2xl">
                <div class="absolute top-10 left-12 flex items-center gap-3 opacity-20 no-print">
                    <i class="fa-solid fa-atom text-git-blue text-xl animate-spin-slow" style="animation-duration: 15s"></i>
                    <span class="text-[10px] font-mono tracking-[0.8em] uppercase">Castor_Core_Analysis</span>
                </div>

                <div class="radar-container">
                    <canvas id="radarChart"></canvas>
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div class="w-36 h-36 rounded-[3.5rem] bg-slate-900 border-4 border-git-border shadow-[0_0_60px_rgba(88,166,255,0.2)] flex flex-col items-center justify-center print:bg-white print:border-black">
                            <span class="text-[10px] font-mono text-slate-500 mb-1 uppercase tracking-widest">èƒ½é‡æ ¸</span>
                            <span id="center-digit" class="text-8xl font-black text-white print:text-black leading-none">?</span>
                            <div class="h-0.5 w-16 bg-git-green my-3 opacity-30"></div>
                            <span class="text-[9px] font-bold text-git-blue tracking-widest uppercase">Kernel</span>
                        </div>
                    </div>
                </div>

                <div class="mt-8 px-10 w-full no-print">
                    <div class="p-6 bg-git-bg/50 rounded-3xl border border-git-border border-dashed flex items-center gap-6">
                        <div class="flex-1 space-y-2">
                            <h4 class="text-[10px] font-black text-git-blue uppercase tracking-widest">åŠ¨æ€ç”Ÿå‘½å®¡è®¡æç¤º (Live Tip)</h4>
                            <p id="dynamic-tip" class="text-xs text-slate-400 leading-relaxed italic"></p>
                        </div>
                        <i class="fa-solid fa-brain text-2xl text-git-green opacity-30"></i>
                    </div>
                </div>
            </section>

            <!-- å®¡è®¡æŠ¥å‘Šç¼–è¯‘å‡ºå£ -->
            <section class="flex flex-col gap-8">
                <div class="flex justify-between items-center px-4 no-print">
                    <div class="flex items-center gap-4">
                        <i class="fa-solid fa-wand-magic-sparkles text-purple-400"></i>
                        <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.5em]">Strategic Report Boiler</h3>
                    </div>
                    <button onclick="compileStrategicReport()" id="compile-btn" class="px-14 py-6 bg-git-panel border border-git-border rounded-3xl text-xs font-black uppercase tracking-[0.2em] text-white hover:border-git-green hover:text-git-green transition-all active:scale-95 shadow-2xl ring-1 ring-white/5">
                        <i class="fa-solid fa-terminal mr-3"></i> ç¼–è¯‘å…¨ç›¸ä½æ·±åº¦æˆ˜ç•¥æŠ¥å‘Š
                    </button>
                </div>
                
                <div id="report-output" class="hidden glass p-12 md:p-24 rounded-[4rem] shadow-[0_50px_100px_-20px_rgba(0,0,0,0.6)] relative overflow-hidden print:border-none print:shadow-none">
                    <div id="markdown-container" class="prose prose-invert max-w-none print:text-black">
                        <!-- Markdown Content Injected Here -->
                    </div>
                    <div class="mt-20 pt-10 border-t border-git-border flex justify-between items-center no-print text-slate-600 font-mono text-[10px] uppercase tracking-widest">
                        <div class="flex items-center gap-3">
                            <span class="w-2.5 h-2.5 rounded-full bg-git-green shadow-[0_0_10px_rgba(63,185,80,0.5)]"></span>
                            <span>ç¼–è¯‘çŠ¶æ€: ç¨³å®šæˆåŠŸ // è®°å½•æ—¶é—´: <span id="timestamp"></span></span>
                        </div>
                        <span>HASH: ALPHA-99-CAST</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- åº•éƒ¨èƒŒæ™¯è£…é¥° -->
    <div class="fixed bottom-0 right-0 p-12 opacity-[0.03] pointer-events-none no-print">
        <i class="fa-solid fa-id-badge text-[20rem]"></i>
    </div>

    <script>
        // --- é€»è¾‘ä¸çŠ¶æ€é…ç½® ---
        const config = {
            targetYear: 2026,
            gender: 'Male',
            currentResults: {},
            lastCompileTime: 0
        };

        let radarInstance = null;
        const apiKey = ""; // API Key è‡ªåŠ¨æ³¨å…¥

        window.onload = () => {
            populateSelectors();
            refreshEngine();
        };

        function populateSelectors() {
            const y = document.getElementById('birthYear');
            const m = document.getElementById('birthMonth');
            const d = document.getElementById('birthDay');

            for (let i = 1950; i <= 2026; i++) {
                let opt = new Option(`${i} å¹´`, i);
                if (i === 1980) opt.selected = true;
                y.add(opt);
            }
            for (let i = 1; i <= 12; i++) {
                let opt = new Option(`${i} æœˆ`, i);
                if (i === 9) opt.selected = true;
                m.add(opt);
            }
            for (let i = 1; i <= 31; i++) {
                let opt = new Option(`${i} æ—¥`, i);
                if (i === 30) opt.selected = true;
                d.add(opt);
            }
        }

        // --- æ ¸å¿ƒè®¡ç®—æ¨¡å‹ ---
        function reduceNum(n) {
            if (!n) return 0;
            let num = Math.abs(parseInt(n));
            while (num > 9) {
                num = String(num).split('').reduce((acc, curr) => acc + parseInt(curr), 0);
            }
            return num;
        }

        function refreshEngine() {
            const by = parseInt(document.getElementById('birthYear').value);
            const bm = parseInt(document.getElementById('birthMonth').value);
            const bd = parseInt(document.getElementById('birthDay').value);
            
            const dStr = String(bd).padStart(2, '0');
            const bmStr = String(bm).padStart(2, '0');
            const yrStr = String(by);

            const A = reduceNum(parseInt(dStr[0]) + parseInt(dStr[1]));
            const B = reduceNum(parseInt(bmStr[0]) + parseInt(bmStr[1]));
            const C = reduceNum(reduceNum(parseInt(yrStr[0]) + parseInt(yrStr[1])) + reduceNum(parseInt(yrStr[2]) + parseInt(yrStr[3])));
            
            const D = reduceNum(A + B);
            const E = reduceNum(B + C);
            const F = reduceNum(D + E);
            const I = reduceNum(D + F);
            const J = reduceNum(E + F);
            const K = reduceNum(I + J);
            const py = reduceNum(config.targetYear + reduceNum(bm) + reduceNum(bd));

            config.currentResults = { A, B, C, D, E, F, K, py, by, bm, bd };
            renderUI();
        }

        function updateProfileUI() {
            const by = document.getElementById('birthYear').value;
            const bm = document.getElementById('birthMonth').value;
            const bd = document.getElementById('birthDay').value;
            document.getElementById('system-id').innerText = `NODE_${by}${bm}${bd} // BRANCH_PRIME`;
        }

        function renderUI() {
            const { A, B, C, D, E, F, K, py } = config.currentResults;

            document.getElementById('flow-display').innerText = py;
            document.getElementById('center-digit').innerText = F;
            document.getElementById('main-num-box').innerText = F;
            document.getElementById('root-num-box').innerText = K;
            updateProfileUI();

            const metrics = [
                { label: 'æ‰§è¡Œé©±åŠ¨åŠ› (Execute)', val: A * 11, icon: 'fa-bolt-lightning' },
                { label: 'é€»è¾‘å®Œæ•´åº¦ (Logic)', val: D * 11, icon: 'fa-layer-group' },
                { label: 'æ ¸å¿ƒç”Ÿå‘½èƒ½ (Apex)', val: F * 11, icon: 'fa-microchip' },
                { label: 'é˜²å¾¡æ€§æŒ‡æ ‡ (Risk)', val: py === 4 ? 98 : 55, icon: 'fa-shield-halved' },
                { label: 'åŸºçŸ³ç¨³å®šæ€§ (Stability)', val: K * 11, icon: 'fa-anchor' }
            ];

            document.getElementById('metrics-stack').innerHTML = metrics.map(m => `
                <div class="space-y-3">
                    <div class="flex justify-between items-center text-[10px] font-black uppercase tracking-widest">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid ${m.icon} text-slate-500 w-4 text-center"></i>
                            <span class="text-slate-400">${m.label}</span>
                        </div>
                        <span class="text-git-blue font-mono font-bold">${m.val}%</span>
                    </div>
                    <div class="h-1.5 w-full bg-git-bg rounded-full overflow-hidden border border-git-border">
                        <div class="h-full bg-git-blue shadow-[0_0_15px_rgba(88,166,255,0.3)] transition-all duration-1000" style="width: ${m.val}%"></div>
                    </div>
                </div>
            `).join('');

            document.getElementById('dynamic-tip').innerText = `// æ·±åº¦åˆ†æï¼šä¸»å‘½æ ¼ ${F} ä¸ºç«æ€§å…ˆé”‹ã€‚å½“å‰æµå¹´ ${py} ä¸ºæ¶æ„é”å®šå¹´ã€‚æ ¸å¿ƒç­–ç•¥ï¼šé€šè¿‡æ ‡å‡†åŒ–æ“ä½œï¼ˆSOPï¼‰å°†çˆ†å‘åŠ›è½¬åŒ–ä¸ºæŒä¹…èµ„äº§ã€‚`;

            renderRadar([A*11, D*11, F*11, C*11, B*11, py===4?98:50, K*11, 92]);
        }

        function renderRadar(data) {
            if (radarInstance) radarInstance.destroy();
            const ctx = document.getElementById('radarChart').getContext('2d');
            Chart.defaults.color = '#8b949e';
            Chart.defaults.font.family = 'JetBrains Mono, Microsoft YaHei';

            radarInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['è¡ŒåŠ¨åŠ›', 'ç³»ç»Ÿé€»è¾‘', 'æ ¸å¿ƒåŠ¿èƒ½', 'å¤–éƒ¨ç¯å¢ƒ', 'æ„Ÿå®˜ç›´è§‰', 'é£æ§è¾¹ç•Œ', 'åé•‡åº•è•´', 'æ„¿æ™¯é«˜åº¦'],
                    datasets: [{
                        data: data,
                        backgroundColor: 'rgba(56, 139, 253, 0.12)',
                        borderColor: '#58a6ff',
                        borderWidth: 3,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#58a6ff',
                        pointRadius: 6,
                        pointHoverRadius: 9
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            grid: { color: 'rgba(48, 54, 61, 0.6)' },
                            angleLines: { color: 'rgba(48, 54, 61, 0.9)' },
                            pointLabels: { font: { size: 12, weight: 'bold' }, padding: 20 },
                            ticks: { display: false },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- åŠ å›ºåçš„ AI å¼‚æ­¥è°ƒåº¦é€»è¾‘ ---
        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const controller = new AbortController();
                    const id = setTimeout(() => controller.abort(), 45000); // 45ç§’è¶…æ—¶æ§åˆ¶
                    const response = await fetch(url, { ...options, signal: controller.signal });
                    clearTimeout(id);
                    if (response.ok) return response;
                    if (response.status !== 429 && response.status < 500) break;
                } catch (err) {
                    if (i === maxRetries - 1) throw err;
                }
                const delay = Math.pow(2, i) * 1000;
                await new Promise(r => setTimeout(r, delay));
            }
            throw new Error("LOGIC_SERVER_BUSY: æœåŠ¡å™¨å¿™çº¿æˆ–è¶…æ—¶");
        }

        async function compileStrategicReport() {
            const btn = document.getElementById('compile-btn');
            const output = document.getElementById('report-output');
            const container = document.getElementById('markdown-container');
            const name = document.getElementById('userName').value;

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner animate-spin mr-3"></i> <span class="loader-dots">æ­£åœ¨ç¼–è¯‘å†³ç­–åŒ…</span>';
            output.classList.remove('hidden');
            container.innerHTML = `<div class="flex flex-col items-center justify-center py-32 space-y-6">
                <div class="text-git-blue font-mono text-sm tracking-[0.4em] uppercase animate-pulse">>>> Accessing Bo_Strategy_Brain...</div>
                <div class="text-slate-600 font-mono text-[10px] uppercase tracking-widest text-center">æ­£åœ¨è§£æå¯¹è±¡ï¼š${name}<br>åˆ†ææ¨¡å¼ï¼šæ·±åº¦ç”Ÿå‘½å…¨æ¯å®¡è®¡</div>
                <div class="w-64 h-1 bg-git-border rounded-full overflow-hidden">
                    <div class="h-full bg-git-green animate-progress" style="width: 70%"></div>
                </div>
            </div>`;

            const { A, B, C, D, E, F, K, py, by, bm, bd } = config.currentResults;
            
            const prompt = `ä½ æ˜¯æ³¢(Bo)ï¼Œé˜¿ç››(Castor)çš„ç§äººæˆ˜ç•¥é¡¾é—®ã€‚è¯·ä¸ºä»¥ä¸‹åˆ†æå¯¹è±¡æ’°å†™ä¸€ä»½æå…¶æ·±åˆ»ã€ç»“æ„ä¸¥æ•´çš„ç”Ÿå‘½æ•°å­—æˆ˜ç•¥å®¡è®¡æŠ¥å‘Šï¼š
            - å¯¹è±¡å§“åï¼š${name}
            - ç”Ÿæ—¥å‚æ•°ï¼š${by}-${bm}-${bd}
            - æ€§æ ¼æ¨¡å‹ï¼šä¸»å‘½æ•° ${F}ï¼Œåé•‡åº•è•´ ${K}ï¼Œè¡ŒåŠ¨ä»£ç  ${A}
            - å…³é”®å‘¨æœŸï¼š2026å¹´å¤„äºæµå¹´åŠ¿èƒ½ ${py} (æ¶æ„é”å®šå¹´)
            
            æŠ¥å‘Šæ ¸å¿ƒå®¡è®¡è¦æ±‚ï¼š
            1. å‰è¨€ï¼šå®šè°ƒ2026ä¸ºâ€œç³»ç»Ÿæ•´åˆâ€ä¸â€œé˜²å®ˆæ€§å¢å€¼â€ä¹‹å¹´ã€‚
            2. æ€§æ ¼å®¡è®¡ï¼šæ·±å…¥åˆ†æä¸»å‘½ ${F} å·å¸¦æ¥çš„é«˜é¢‘çˆ†å‘åŠ›å¦‚ä½•è½¬åŒ–ä¸ºé•¿æœŸä¼˜åŠ¿ã€‚
            3. å•†ä¸šå»ºè®®ï¼šé’ˆå¯¹ U13 è¶³çƒé’è®­é¡¹ç›®çš„è§„èŒƒåŒ–ï¼ˆSOPï¼‰å’Œ 5 ä¸‡æœ¬é‡‘è‚¡ç¥¨äº¤æ˜“ï¼ˆYTL/SUNCONï¼‰çš„é™æ€é˜²å®ˆç­–ç•¥ã€‚
            4. æƒ…æ„Ÿ/å…³ç³»å¤ç›˜ï¼šåˆ†æ 3 å·ä¸ 8 å·ï¼ˆå¦‚1983-09-05ï¼‰ä¹‹é—´å¿…ç„¶çš„é€»è¾‘è§£æ„åŠåˆ†æ‰‹åçš„â€œç®—åŠ›å›æ”¶â€ã€‚
            5. 2026 æ‰§è¡Œè·¯çº¿å›¾ï¼šQ1-Q4 çš„å…³é”®åŠ¨ä½œã€‚
            
            è¯­æ°”ï¼šæåº¦ä¸“ä¸šã€å†·å³»ã€å•†ä¸šå®¡è®¡å®˜é£æ ¼ã€‚è¯·ç”¨ä¸“ä¸šä¸­æ–‡ Markdown æ ¼å¼æ’°å†™ã€‚å†…å®¹åŠ¡å¿…å……å®ã€æ·±åˆ»ã€‚`;

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                const response = await fetchWithRetry(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "ä½ æ˜¯ä¸€ä½ç²¾é€šä¼ä¸šæ¶æ„ä¸ç”Ÿå‘½æ•°å­—åšå¼ˆçš„é¡¶å°–æˆ˜ç•¥é¡¾é—®ã€‚ä½ çš„å®¡è®¡ç»“æœå¿…é¡»å…·å¤‡ç»å¯¹çš„å•†ä¸šå¯è¡Œæ€§ã€‚" }] }
                    })
                });
                
                const data = await response.json();
                const result = data.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (!result) throw new Error("DATA_STREAM_EMPTY: å®¡è®¡æµæ— è¿”å›");
                
                container.innerHTML = marked.parse(result);
                document.getElementById('timestamp').innerText = new Date().toLocaleString();
                output.scrollIntoView({ behavior: 'smooth' });
                
            } catch (err) {
                container.innerHTML = `
                    <div class="p-16 border border-git-red/20 bg-git-red/5 rounded-[3rem] text-center">
                        <i class="fa-solid fa-bolt-lightning text-4xl text-git-red mb-6"></i>
                        <h3 class="text-git-red font-black uppercase tracking-widest mb-3">RUNTIME_INTERRUPT: æµå¼‚å¸¸</h3>
                        <p class="text-sm text-slate-500 font-mono mb-8 italic">é”™è¯¯ç : ${err.message}</p>
                        <div class="flex gap-4 justify-center">
                            <button onclick="compileStrategicReport()" class="px-8 py-3 bg-git-red/10 border border-git-red/30 text-git-red rounded-xl text-[10px] font-bold uppercase hover:bg-git-red hover:text-white transition-all">é‡æ–°åˆå§‹åŒ–</button>
                            <button onclick="location.reload()" class="px-8 py-3 bg-git-panel border border-git-border text-slate-400 rounded-xl text-[10px] font-bold uppercase hover:text-white transition-all">å¼ºåˆ¶é‡å¯ç³»ç»Ÿ</button>
                        </div>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-rotate mr-3"></i> é‡æ–°ç¼–è¯‘å®¡è®¡æŠ¥å‘Š';
            }
        }

        // --- äº¤äº’å¤„ç†å™¨ ---
        function setGender(g) {
            config.gender = g;
            document.getElementById('btn-male').className = g === 'Male' ? 'px-5 py-1.5 rounded-md text-[10px] font-bold bg-git-blue text-white shadow-lg transition-all' : 'px-5 py-1.5 rounded-md text-[10px] font-bold text-slate-500';
            document.getElementById('btn-female').className = g === 'Female' ? 'px-5 py-1.5 rounded-md text-[10px] font-bold bg-git-red text-white shadow-lg transition-all' : 'px-5 py-1.5 rounded-md text-[10px] font-bold text-slate-500';
            document.getElementById('gender-display').innerHTML = g === 'Male' ? '<i class="fa-solid fa-mars"></i>' : '<i class="fa-solid fa-venus text-git-red"></i>';
            refreshEngine();
        }

        function resetSystem() {
            if(confirm("è­¦å‘Šï¼šæ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰ç¼“å†²åŒºå¹¶é‡ç½®å†…æ ¸ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ")) {
                location.reload();
            }
        }

        function shareWhatsApp() {
            const name = document.getElementById('userName').value;
            const res = config.currentResults;
            const msg = encodeURIComponent(
                `ğŸ“‹ *${name} ç”Ÿå‘½æˆ˜ç•¥å®¡è®¡ç®€æŠ¥* (v7.2)\n` +
                `------------------------------------\n` +
                `ğŸ”¢ ä¸»å‘½æ ¸å¿ƒ: ${res.F} | åé•‡åº•è•´: ${res.K}\n` +
                `âš¡ 2026å¹´æµå¹´: ${res.py} (æ¶æ„é”å®šå¹´)\n` +
                `ğŸ’¡ æ ¸å¿ƒå»ºè®®ï¼šå»ºç«‹ SOPã€é”æ­»å˜é‡ã€é˜²å¾¡æ€§å¢é•¿ã€‚\n` +
                `>>> è¯¦ç»†é‡åŒ– PDF è¯·æŸ¥æ”¶éšé™„é™„ä»¶ã€‚`
            );
            window.open(`https://wa.me/?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>
