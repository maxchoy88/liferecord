<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>é˜¿ç››æˆ˜ç•¥çŸ©é˜µç»ˆç«¯ v5.4 - æˆ˜ç•¥æ‰“åŒ…ç‰ˆ</title>
    <!-- æ ¸å¿ƒåº“å¼•å…¥ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'git-bg': '#0d1117',
                        'git-border': '#30363d',
                        'git-blue': '#58a6ff',
                        'git-green': '#3fb950',
                        'git-red': '#f85149',
                        'matrix-gold': '#d4af37'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Inter:wght@400;900&display=swap');
        body { font-family: 'Inter', 'Microsoft YaHei', sans-serif; background-color: #0d1117; color: #c9d1d9; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(22, 27, 34, 0.8); backdrop-filter: blur(12px); border: 1px solid #30363d; }
        
        /* Markdown æŠ¥å‘Šæ ·å¼ä¼˜åŒ– */
        #ai-text h1 { font-size: 1.5rem; font-weight: 800; margin-bottom: 1rem; color: #58a6ff; border-bottom: 1px solid #30363d; padding-bottom: 0.5rem; }
        #ai-text h2 { font-size: 1.2rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.75rem; color: #3fb950; }
        #ai-text p { margin-bottom: 1rem; line-height: 1.8; }
        #ai-text ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        #ai-text strong { color: #fff; }
        #ai-text blockquote { border-left: 4px solid #30363d; padding-left: 1rem; font-style: italic; color: #8b949e; }

        /* æ‰“å°æ¨¡å¼æ·±åº¦ä¼˜åŒ–ï¼šç¡®ä¿å¯¼å‡ºçš„ PDF æå…¶æ•´é½ */
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; color: black !important; padding: 0 !important; }
            .glass { background: white !important; border: 1px solid #eee !important; box-shadow: none !important; color: black !important; border-radius: 0 !important; }
            #report-content { display: block !important; }
            .lg\:col-span-8, .lg\:col-span-4 { width: 100% !important; margin-bottom: 2rem; }
            canvas { max-width: 100% !important; height: auto !important; }
            #ai-text h1, #ai-text h2 { color: black !important; border-bottom-color: #000 !important; }
            #ai-text strong { color: #000 !important; }
            #ai-text { border-left-color: #ddd !important; }
            .heatmap-container { display: block !important; page-break-inside: avoid; }
        }
        
        .animate-spin-slow { animation: spin 10s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen antialiased">

    <div class="max-w-6xl mx-auto flex flex-col gap-8">
        
        <!-- é¡µçœ‰ -->
        <header class="flex justify-between items-center border-b border-git-border pb-6 no-print">
            <div class="flex items-center gap-4">
                <div class="p-3 bg-slate-900 border border-git-border rounded-xl text-git-blue shadow-inner">
                    <i class="fa-brands fa-github text-3xl"></i>
                </div>
                <div>
                    <div class="flex items-center gap-2">
                        <h1 class="text-xl font-bold text-white tracking-tight">é˜¿ç››-æˆ˜ç•¥å®¡è®¡ç»ˆç«¯-v5.4</h1>
                        <span class="text-[10px] font-bold border border-git-green px-2 py-0.5 rounded-full text-git-green bg-git-green/10 uppercase">PDF æ‰“åŒ…å°±ç»ª</span>
                    </div>
                    <p class="text-xs text-slate-500 font-mono mt-1 flex items-center gap-2 uppercase tracking-tighter">
                        <i class="fa-solid fa-file-export text-git-green"></i> å¯¼å‡ºæ¨¡å¼ï¼šå…¨æ¯ Unicode å®‰å…¨
                    </p>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="shareWhatsApp()" class="flex items-center gap-2 px-4 py-2 bg-[#21262d] border border-git-border rounded-lg text-sm font-semibold hover:bg-[#30363d] transition-all">
                    <i class="fa-brands fa-whatsapp text-git-green text-lg"></i> <span class="hidden sm:inline">WhatsApp å‘é€æ‘˜è¦</span>
                </button>
                <button onclick="window.print()" class="flex items-center gap-2 px-4 py-2 bg-git-green text-white rounded-lg text-sm font-semibold shadow-lg hover:brightness-110 transition-all active:scale-95">
                    <i class="fa-solid fa-file-pdf"></i> <span class="hidden sm:inline">å¯¼å‡º PDF æŠ¥å‘Š</span>
                </button>
            </div>
        </header>

        <!-- æ‰“å°æŠ¥å‘ŠæŠ¬å¤´ -->
        <div class="hidden only-print text-center border-b-4 border-black pb-8 mb-10">
            <h1 class="text-3xl font-black text-black uppercase tracking-widest">é˜¿ç›› (Castor) 2026 å…¨ç›¸ä½æˆ˜ç•¥æ‰§è¡Œè“å›¾</h1>
            <p class="text-sm font-mono mt-2 text-slate-600 italic">â€œæ³¢ (Bo) AI æˆ˜ç•¥æ ¸å¿ƒ v5.4 | å•†ä¸šå…¨æ¯å®¡è®¡æŠ¥å‘Šâ€</p>
        </div>

        <!-- 1. é…ç½®æ§åˆ¶å° -->
        <section class="grid grid-cols-1 lg:grid-cols-12 gap-6 no-print">
            <div class="lg:col-span-8 glass p-6 rounded-3xl shadow-xl">
                <div class="flex justify-between items-center mb-6 px-1">
                    <div class="flex items-center gap-2 text-white font-bold text-[10px] uppercase tracking-widest"><i class="fa-solid fa-gears text-git-blue"></i> çŸ©é˜µåˆå§‹åŒ–å‚æ•° (INIT_PARAMS)</div>
                    <div class="flex bg-git-bg p-1 rounded-lg border border-git-border">
                        <button onclick="setGender('Male')" id="btn-male" class="px-4 py-1.5 rounded-md text-[10px] font-bold bg-git-blue text-white shadow-lg transition-all">ç”· MALE</button>
                        <button onclick="setGender('Female')" id="btn-female" class="px-4 py-1.5 rounded-md text-[10px] font-bold text-slate-500 transition-all">å¥³ FEMALE</button>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="flex flex-col gap-1">
                        <span class="text-[9px] text-slate-500 font-bold ml-1">å‡ºç”Ÿå¹´ä»½</span>
                        <select id="birthYear" onchange="updateMatrix()" class="bg-git-bg border border-git-border rounded-xl p-3 text-sm font-black text-white focus:border-git-blue outline-none cursor-pointer"></select>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-[9px] text-slate-500 font-bold ml-1">å‡ºç”Ÿæœˆä»½</span>
                        <select id="birthMonth" onchange="updateMatrix()" class="bg-git-bg border border-git-border rounded-xl p-3 text-sm font-black text-white focus:border-git-blue outline-none cursor-pointer"></select>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-[9px] text-slate-500 font-bold ml-1">å‡ºç”Ÿæ—¥æœŸ</span>
                        <select id="birthDay" onchange="updateMatrix()" class="bg-git-bg border border-git-border rounded-xl p-3 text-sm font-black text-white focus:border-git-blue outline-none cursor-pointer"></select>
                    </div>
                </div>
                <div class="pt-4 border-t border-git-border">
                    <span class="text-[9px] text-git-green font-bold uppercase tracking-widest mb-4 block px-1">è®¾å®šç›®æ ‡æ‰§è¡Œå¹´ä»½ (TARGET_YEAR)</span>
                    <div id="year-selector" class="flex gap-2 overflow-x-auto no-scrollbar py-1"></div>
                </div>
            </div>
            <div class="lg:col-span-4 glass p-6 rounded-3xl flex flex-col justify-center items-center text-center">
                <span class="text-[10px] font-bold text-slate-500 uppercase mb-2 tracking-widest">æµå¹´ Commit æŒ‡æ•°</span>
                <div id="flow-number" class="text-8xl font-black text-git-green tracking-tighter mb-2 animate-pulse">--</div>
                <div id="flow-label" class="text-[10px] font-mono text-git-green uppercase px-4 py-1 bg-git-green/10 rounded-full border border-git-green/20">SYSTEM_READY</div>
            </div>
        </section>

        <!-- 2. å…¨æ¯æŠ¥å‘ŠåŒºåŸŸ -->
        <main id="report-content" class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-stretch">
            
            <!-- å·¦ä¾§é¢æ¿ -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                <!-- ä¸ªäººé‡åŒ–ä¾§å†™ -->
                <div class="glass p-8 rounded-[2.5rem] shadow-2xl print:border-none">
                    <div class="flex items-center gap-4 mb-8 pb-8 border-b border-git-border">
                        <div id="avatar-box" class="w-16 h-16 rounded-2xl bg-git-bg flex items-center justify-center border border-git-border text-2xl">
                            <i class="fa-solid fa-mars text-git-blue"></i>
                        </div>
                        <div class="flex-1">
                            <h2 id="display-name" class="text-2xl font-black tracking-tight print:text-black">é˜¿ç›› (Castor)</h2>
                            <p id="display-id" class="text-[9px] text-slate-500 font-mono uppercase mt-2 tracking-widest"></p>
                        </div>
                    </div>
                    <div id="metrics-list" class="space-y-5"></div>
                    
                    <!-- Money æƒ…ç»ªä¸­å’Œå› å­ -->
                    <div class="mt-10 p-5 bg-git-bg rounded-xl border border-rose-500/20 print:bg-slate-50">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-[10px] font-black text-rose-400 uppercase flex items-center gap-2"><i class="fa-solid fa-cat"></i> ç”Ÿç‰©ç¨³å‹å™¨: Money</span>
                            <span class="text-[9px] font-mono text-rose-300">åœ¨çº¿å¹³è¡¡ä¸­</span>
                        </div>
                        <div class="flex gap-1.5">
                            <div class="h-4 flex-1 bg-rose-500/40 rounded-sm"></div>
                            <div class="h-4 flex-1 bg-rose-500/40 rounded-sm"></div>
                            <div class="h-4 flex-1 bg-rose-500/40 rounded-sm"></div>
                            <div class="h-4 flex-1 bg-rose-500/40 rounded-sm"></div>
                            <div class="h-4 flex-1 bg-git-bg rounded-sm border border-git-border"></div>
                        </div>
                        <p class="text-[9px] text-slate-500 mt-3 italic text-center uppercase tracking-tighter">"é€šè¿‡ Money çš„ç¨³æ€é¢‘ç‡å¯¹å†²äº¤æ˜“ç„¦è™‘"</p>
                    </div>
                </div>

                <!-- é€»è¾‘å†…æ ¸ä»£ç  -->
                <div class="glass p-6 rounded-2xl print:page-break-inside-avoid">
                    <div class="flex items-center gap-2 mb-4 text-git-blue">
                        <i class="fa-solid fa-terminal text-xs"></i>
                        <span class="text-[10px] font-black uppercase tracking-widest">æ ¸å¿ƒç®—æ³•é€»è¾‘ (Life_Kernel.js)</span>
                    </div>
                    <pre id="code-logic" class="text-[11px] font-mono leading-[1.8] text-[#c9d1d9] bg-git-bg p-5 rounded-xl border border-git-border print:bg-white print:text-black overflow-hidden"></pre>
                </div>
            </div>

            <!-- å³ä¾§ï¼šå…«è§’é›·è¾¾ç½—ç›˜ -->
            <div class="lg:col-span-8 glass p-10 rounded-[3.5rem] flex flex-col items-center justify-center relative print:border-none">
                <div class="absolute top-10 left-12 flex items-center gap-2 opacity-20 no-print">
                    <i class="fa-solid fa-fingerprint animate-pulse text-git-blue"></i>
                    <span class="text-[10px] font-mono tracking-[0.6em]">DECISION_MATRIX_V5.4</span>
                </div>

                <div class="relative w-[500px] h-[500px] flex items-center justify-center">
                    <canvas id="radarChart"></canvas>
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div class="w-32 h-32 rounded-[3.5rem] bg-slate-900 border-4 border-git-border shadow-[0_0_50px_rgba(88,166,255,0.2)] flex flex-col items-center justify-center print:bg-white print:text-black print:border-black">
                            <span class="text-[10px] font-mono text-slate-500 mb-1">ä¸»å‘½æ•°</span>
                            <span id="center-f" class="text-7xl font-black leading-none">3</span>
                            <div class="h-0.5 w-12 bg-git-green my-2"></div>
                            <span class="text-[9px] font-bold text-git-blue tracking-widest uppercase">Apex_Run</span>
                        </div>
                    </div>
                </div>

                <!-- GitHub èƒ½é‡çƒ­åŠ›å›¾ -->
                <div class="heatmap-container mt-20 w-full pt-10 border-t border-git-border print:border-slate-200">
                    <div class="flex justify-between items-end mb-4 px-4">
                        <h4 class="text-[11px] font-black text-white uppercase tracking-widest flex items-center gap-2 print:text-black font-bold"><i class="fa-solid fa-layer-group text-git-green no-print"></i> é˜¿ç››æˆ˜ç•¥æ‰§è¡Œçƒ­åŠ›å›¾ (Commit Intensity)</h4>
                        <div class="flex gap-1 items-center text-[8px] font-mono text-slate-500 no-print">
                            <span>ä½å¼ºåº¦</span>
                            <div class="w-3 h-3 rounded-sm bg-[#161b22]"></div>
                            <div class="w-3 h-3 rounded-sm bg-[#0e4429]"></div>
                            <div class="w-3 h-3 rounded-sm bg-[#39d353]"></div>
                            <span>é«˜å¼ºåº¦</span>
                        </div>
                    </div>
                    <div id="heatmap-grid" class="grid grid-cols-[repeat(52,1fr)] gap-1 px-4"></div>
                </div>
            </div>
        </main>

        <!-- 3. AI æŠ¥å‘Šå±•ç¤ºåŒº -->
        <section class="flex flex-col gap-6">
            <div class="flex justify-between items-center px-4 no-print">
                <h3 class="text-[11px] font-bold text-slate-500 uppercase tracking-[0.5em] flex items-center gap-2"><i class="fa-solid fa-wand-magic-sparkles text-purple-400"></i> AI å†³ç­–å®¡è®¡æŠ¥å‘Š</h3>
                <button onclick="generateAIReport()" id="ai-btn" class="px-10 py-4 bg-git-green hover:brightness-110 text-white rounded-xl text-[11px] font-black uppercase tracking-widest flex items-center gap-3 shadow-2xl transition-all active:scale-95">
                    <i class="fa-solid fa-microchip"></i> ç¼–è¯‘å…¨æ–¹ä½æˆ˜ç•¥è“å›¾
                </button>
            </div>
            <div id="ai-output" class="hidden glass p-12 rounded-[3.5rem] shadow-2xl relative overflow-hidden print:border-none">
                <div id="ai-text" class="prose prose-invert max-w-none print:text-black">
                    <!-- Markdown Content -->
                </div>
                <div class="mt-10 pt-8 border-t border-git-border text-[9px] font-mono text-slate-600 flex justify-between no-print">
                    <span>æŠ¥å‘Šç‰ˆæœ¬å·: CAST-V5.4-SECURE</span>
                    <span>ç”Ÿæˆæ—¶é—´: <span id="report-time"></span></span>
                </div>
            </div>
        </section>

        <footer class="text-center pb-20 opacity-30 print:opacity-100 print:text-slate-400">
            <p class="text-[11px] uppercase tracking-[1.5em] font-mono">BO STRATEGIC OS â€¢ DATA DRIVEN DECISIONS â€¢ CASTOR 2026</p>
        </footer>
    </div>

    <script>
        let currentProfile = { gender: 'Male', targetYear: 2026 };
        const apiKey = ""; // ç¯å¢ƒè‡ªåŠ¨æ³¨å…¥

        window.onload = () => {
            initSelectors();
            updateMatrix();
            generateHeatmap();
        };

        function initSelectors() {
            const ySelect = document.getElementById('birthYear');
            const mSelect = document.getElementById('birthMonth');
            const dSelect = document.getElementById('birthDay');
            const flowSelect = document.getElementById('year-selector');

            for (let i = 1950; i <= 2026; i++) {
                let opt = new Option(i + " å¹´", i);
                if (i === 1980) opt.selected = true;
                ySelect.add(opt);
            }
            for (let i = 1; i <= 12; i++) {
                let opt = new Option(i + " æœˆ", i);
                if (i === 9) opt.selected = true;
                mSelect.add(opt);
            }
            for (let i = 1; i <= 31; i++) {
                let opt = new Option(i + " æ—¥", i);
                if (i === 30) opt.selected = true;
                dSelect.add(opt);
            }

            [2024, 2025, 2026, 2027, 2028, 2029, 2030].forEach(y => {
                let btn = document.createElement('button');
                btn.className = `shrink-0 px-6 py-2.5 rounded-xl text-xs font-black transition-all border ${y === 2026 ? 'bg-git-blue/20 border-git-blue text-git-blue shadow-lg' : 'bg-git-bg border-git-border text-slate-500'}`;
                btn.innerText = y + " å¹´";
                btn.onclick = () => {
                    currentProfile.targetYear = y;
                    document.querySelectorAll('#year-selector button').forEach(b => b.className = 'shrink-0 px-6 py-2.5 rounded-xl text-xs font-black transition-all border bg-git-bg border-git-border text-slate-500');
                    btn.className = 'shrink-0 px-6 py-2.5 rounded-xl text-xs font-black transition-all border bg-git-blue/20 border-git-blue text-git-blue shadow-lg';
                    updateMatrix();
                };
                flowSelect.appendChild(btn);
            });
        }

        function reduceNum(n) {
            if (!n) return 0;
            let num = Math.abs(parseInt(n));
            while (num > 9) {
                num = String(num).split('').reduce((acc, curr) => acc + parseInt(curr), 0);
            }
            return num;
        }

        function calculateResults() {
            const y = parseInt(document.getElementById('birthYear').value);
            const m = parseInt(document.getElementById('birthMonth').value);
            const d = parseInt(document.getElementById('birthDay').value);
            const ty = currentProfile.targetYear;

            const dStr = String(d).padStart(2, '0');
            const mStr = String(m).padStart(2, '0');
            const yStr = String(y);

            const A = reduceNum(parseInt(dStr[0]) + parseInt(dStr[1]));
            const B = reduceNum(parseInt(mStr[0]) + parseInt(mStr[1]));
            const C = reduceNum(reduceNum(parseInt(yStr[0]) + parseInt(yStr[1])) + reduceNum(parseInt(yStr[2]) + parseInt(yStr[3])));
            const D = reduceNum(A + B);
            const E = reduceNum(B + C);
            const F = reduceNum(D + E);
            const I = reduceNum(D + F);
            const J = reduceNum(E + F);
            const K = reduceNum(I + J);
            const py = reduceNum(ty + reduceNum(m) + reduceNum(d));

            return { A, B, C, D, E, F, K, py, y, m, d };
        }

        let chartInstance = null;
        function updateMatrix() {
            const res = calculateResults();
            document.getElementById('flow-number').innerText = res.py;
            document.getElementById('center-f').innerText = res.F;
            document.getElementById('display-id').innerText = `ID: ${res.y}${res.m}${res.d} | ç‰ˆæœ¬: 5.4`;
            
            document.getElementById('code-logic').innerText = 
`{
  "ä¸»ä½“åç§°": "é˜¿ç›› (Castor)",
  "æ ¸å¿ƒå‘½æ ¼": ${res.F},
  "åé•‡ç ": ${res.K},
  "æµå¹´å‘¨æœŸ": ${res.py},
  "æ¶æ„çŠ¶æ€": "${res.py === 4 ? 'STRUCTURAL_BUILD' : 'DYNAMIC_ADJUST'}"
}`;

            const metrics = [
                { label: 'æ‰§è¡Œçˆ†å‘åŠ›', val: res.A * 11 },
                { label: 'æˆ˜ç•¥ç­¹è°‹åŠ›', val: res.D * 11 },
                { label: 'ç”Ÿå‘½æ ¸å¿ƒèƒ½', val: res.F * 11 },
                { label: 'å¤–éƒ¨ç¯å¢ƒå˜', val: res.C * 11 },
                { label: 'æƒ…æ„Ÿç›´è§‰å€¼', val: res.B * 11 },
                { label: 'é£é™©æ§åˆ¶é˜ˆ', val: res.py === 4 ? 98 : 55 },
                { label: 'åé•‡åº•è•´åŠ›', val: res.K * 11 },
                { label: 'æ„¿æ™¯é«˜åº¦', val: 94 }
            ];

            const listContainer = document.getElementById('metrics-list');
            listContainer.innerHTML = metrics.map(m => `
                <div class="space-y-1.5">
                    <div class="flex justify-between items-center text-[9px] font-black uppercase">
                        <span class="text-slate-500 tracking-widest">${m.label}</span>
                        <span class="text-git-blue font-mono">${m.val}%</span>
                    </div>
                    <div class="h-1 w-full bg-git-bg rounded-full overflow-hidden border border-git-border">
                        <div class="h-full bg-git-blue transition-all duration-1000" style="width: ${m.val}%"></div>
                    </div>
                </div>
            `).join('');

            if(chartInstance) chartInstance.destroy();
            const ctx = document.getElementById('radarChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: metrics.map(m => m.label),
                    datasets: [{
                        data: metrics.map(m => m.val),
                        backgroundColor: 'rgba(56, 139, 253, 0.1)',
                        borderColor: '#58a6ff',
                        borderWidth: 2,
                        pointBackgroundColor: '#58a6ff',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { r: { grid: { color: '#30363d' }, angleLines: { color: '#30363d' }, pointLabels: { color: '#8b949e', font: { size: 11, weight: 'bold' } }, ticks: { display: false }, suggestedMin: 0, suggestedMax: 100 } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        async function callBo(prompt, system) {
            const output = document.getElementById('ai-output');
            const textDiv = document.getElementById('ai-text');
            const btn = document.getElementById('ai-btn');

            output.classList.remove('hidden');
            textDiv.innerHTML = "<p class='animate-pulse text-git-blue mono uppercase tracking-widest'>>>> æ­£åœ¨ç¼–è¯‘å…¨æ¯å®¡è®¡æ—¥å¿—...<br>>>> æ³¨å…¥æ³¢ (Bo) æˆ˜ç•¥æ ¸å¿ƒ v5.4...</p>";
            btn.disabled = true;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: system }] } })
                });
                const data = await response.json();
                const result = data.candidates?.[0]?.content?.parts?.[0]?.text || "åˆ†æä¸­æ–­ï¼šæ ¸å¿ƒè´Ÿè½½è¿‡é«˜";
                
                textDiv.innerHTML = marked.parse(result);
                document.getElementById('report-time').innerText = new Date().toLocaleString();
                output.scrollIntoView({ behavior: 'smooth' });
            } catch (err) {
                textDiv.innerHTML = `<p class="text-git-red font-mono">ERROR_LOG: ${err.message}</p>`;
            } finally {
                btn.disabled = false;
            }
        }

        function generateAIReport() {
            const res = calculateResults();
            const prompt = `åˆ†æé˜¿ç››(Castor) 1980-09-30 åºšç”³å¹´ã€‚å‘½æ ¼æ ¸å¿ƒ ${res.F}, åé•‡ ${res.K}ã€‚æµå¹´åˆ†æç›®æ ‡: ${currentProfile.targetYear} (æµå¹´æ•° ${res.py})ã€‚
            æ ¸å¿ƒå®¡è®¡å†…å®¹:
            1. é’ˆå¯¹å…¶ 2026 æ¶æ„å¹´(4) çš„ U13 è¶³çƒé¡¹ç›®ã€‚é‡ç‚¹åˆ†æå¦‚ä½•ä»â€œæ•£è£…â€å˜ä¸ºâ€œç³»ç»Ÿâ€ï¼Œä»â€œäººæ²»â€å˜ä¸ºâ€œæ³•æ²»â€ã€‚
            2. é’ˆå¯¹å…¶ 5ä¸‡æœ¬é‡‘åœ¨ YTL/SUNCON çš„æ“ä½œã€‚æŒ‡å‡ºåœ¨ 4 å·æµå¹´ä¸­ï¼Œâ€œè€å¾—ä½å¯‚å¯â€æ˜¯ç¬¬ä¸€è¦ç´ ã€‚
            3. å¤ç›˜å‰ä»»(1983-09-05)å…³ç³»ç»ˆç»“çš„æ•°å­—å¿…ç„¶æ€§(3å·ä¸8å·çš„æ§åˆ¶æƒåšå¼ˆ)ã€‚
            4. ç‹¸èŠ±çŒ« Money æ‰®æ¼”çš„æƒ…ç»ªé™å™ªè§’è‰²ã€‚
            è¦æ±‚ï¼šMarkdown æ ¼å¼ï¼Œæ•´é½åˆ’ä¸€ï¼Œåˆ†èŠ‚æ˜ç¡®ã€‚`;
            callBo(prompt, "ä½ æ˜¯ä¸€ä½é¡¶å°–çš„ç”Ÿå‘½å¯†ç æˆ˜ç•¥å®¡è®¡å¸ˆæ³¢ (Bo)ã€‚");
        }

        function setGender(g) {
            currentProfile.gender = g;
            document.getElementById('btn-male').className = g === 'Male' ? 'px-4 py-1.5 rounded-md text-[10px] font-bold bg-git-blue text-white shadow-lg transition-all' : 'px-4 py-1.5 rounded-md text-[10px] font-bold text-slate-500';
            document.getElementById('btn-female').className = g === 'Female' ? 'px-4 py-1.5 rounded-md text-[10px] font-bold bg-git-red text-white shadow-lg transition-all' : 'px-4 py-1.5 rounded-md text-[10px] font-bold text-slate-500';
            document.getElementById('avatar-box').innerHTML = g === 'Male' ? '<i class="fa-solid fa-mars text-git-blue"></i>' : '<i class="fa-solid fa-venus text-git-red"></i>';
            updateMatrix();
        }

        function generateHeatmap() {
            const grid = document.getElementById('heatmap-grid');
            for (let i = 0; i < 52 * 7; i++) {
                let cell = document.createElement('div');
                let seed = Math.random();
                let color = seed > 0.9 ? 'bg-git-green' : seed > 0.7 ? 'bg-[#26a641]' : seed > 0.4 ? 'bg-[#006d32]' : 'bg-[#161b22]';
                cell.className = `w-full aspect-square rounded-[1px] ${color}`;
                grid.appendChild(cell);
            }
        }

        function shareWhatsApp() {
            const res = calculateResults();
            const msg = encodeURIComponent(
                `ğŸ“‹ *CASTOR STRATEGIC BLUEPRINT* v5.4\n` +
                `------------------------------------\n` +
                `ğŸ”¢ æ ¸å¿ƒä¸»å‘½: ${res.F} | åé•‡: ${res.K}\n` +
                `âš¡ ç›®æ ‡æµå¹´: ${currentProfile.targetYear} (æµå¹´æ•°: ${res.py})\n` +
                `ğŸ’¡ å®¡è®¡å»ºè®®: æ¶æ„æ‰æ ¹å¹´ï¼Œä¸¥æ§é£é™©ï¼Œç³»ç»Ÿé©±åŠ¨ã€‚\n` +
                `>>> å…¨æ¯æ•°æ®æŠ¥å‘Šå·²æ‰“åŒ…ã€‚PDF è§éšé™„é™„ä»¶ã€‚`
            );
            window.open(`https://wa.me/?text=${msg}`, '_blank');
        }
    </script>
</body>
</html>
